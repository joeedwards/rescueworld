<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Adoptar.io - Pet Rescue</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow: hidden; touch-action: none; background: #1a1a2e; }
    #game { display: block; width: 100%; height: 100%; touch-action: none; }
    #game-wrap { display: none; position: fixed; inset: 0; }
    #game-wrap.visible { display: block; }
    #game-wrap #game { width: 100%; height: 100%; }
    #game-wrap #ui { position: fixed; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; }
    #ui { position: fixed; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; }
    #ui > * { pointer-events: auto; }
    .top-bar {
      position: absolute; top: 0; left: 0; right: 0; height: 48px;
      background: linear-gradient(180deg, rgba(30,35,50,0.97) 0%, rgba(22,26,38,0.97) 100%);
      border-bottom: 2px solid rgba(255,255,255,0.12);
      display: flex; align-items: center; justify-content: space-between; padding: 0 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.4);
    }
    .top-bar .score { font: 700 18px/1 Rubik, sans-serif; color: #7bed9f; text-shadow: 0 0 12px rgba(123,237,159,0.4); }
    .top-bar .game-title { font: 700 16px/1 Rubik, sans-serif; color: rgba(255,255,255,0.9); letter-spacing: 0.12em; }
    .top-bar .timer { font: 700 18px/1 Rubik, sans-serif; color: #fff; letter-spacing: 0.05em; }
    .top-bar #auth-area { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    .top-bar #auth-area.hidden { display: none; }
    .top-bar .auth-link { font: 600 12px/1 Rubik, sans-serif; color: rgba(255,255,255,0.85); text-decoration: none; }
    .top-bar .auth-link:hover { color: #7bed9f; }
    .top-bar .auth-profile { font: 600 12px/1 Rubik, sans-serif; color: #7bed9f; }
    .top-bar .auth-guest { font: 600 12px/1 Rubik, sans-serif; color: rgba(255,255,255,0.6); margin-left: 4px; }
    .top-bar .settings-btn { background: none; border: none; color: rgba(255,255,255,0.8); font-size: 18px; cursor: pointer; padding: 0 4px; }
    .top-bar .settings-btn:hover { color: #7bed9f; }
    .top-bar .ping-display { font: 600 11px Rubik, sans-serif; color: rgba(255,255,255,0.7); margin-left: 4px; }
    .switch-server { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: rgba(35,42,60,0.98); border: 2px solid #ff6b6b; border-radius: 12px; padding: 14px 20px; z-index: 55; text-align: center; box-shadow: 0 8px 24px rgba(0,0,0,0.4); }
    .switch-server.hidden { display: none; }
    .switch-server p { font: 600 14px Rubik, sans-serif; color: #fff; margin-bottom: 10px; }
    .switch-server-btn { padding: 8px 16px; font: 600 12px Rubik, sans-serif; background: #ff6b6b; border: none; border-radius: 6px; color: #fff; cursor: pointer; }
    .lobby-overlay { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 69; background: rgba(35,42,60,0.98); border: 2px solid #7bed9f; border-radius: 12px; padding: 24px; text-align: center; box-shadow: 0 8px 24px rgba(0,0,0,0.5); }
    .lobby-overlay.hidden { display: none; }
    .lobby-message { font: 700 16px Rubik, sans-serif; color: #7bed9f; margin-bottom: 12px; }
    .lobby-countdown { font: 600 14px Rubik, sans-serif; color: rgba(255,255,255,0.9); margin-bottom: 14px; }
    .lobby-countdown.hidden { display: none; }
    .lobby-ready-btn.hidden { display: none; }
    .fight-ally-overlay { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 70; background: rgba(35,42,60,0.98); border: 2px solid #7bed9f; border-radius: 12px; padding: 20px; text-align: center; box-shadow: 0 8px 24px rgba(0,0,0,0.5); }
    .fight-ally-overlay.hidden { display: none; }
    .fight-ally-title { font: 700 14px Rubik, sans-serif; color: #7bed9f; margin-bottom: 8px; }
    .fight-ally-name { font: 600 13px Rubik, sans-serif; color: rgba(255,255,255,0.9); margin-bottom: 14px; }
    .fight-ally-btns { display: flex; gap: 12px; justify-content: center; }
    .fight-ally-btn { padding: 10px 20px; font: 600 13px Rubik, sans-serif; border-radius: 8px; cursor: pointer; border: none; }
    .fight-btn { background: #ff6b6b; color: #fff; }
    .ally-btn { background: #7bed9f; color: #1a1a2e; }
    .cpu-warning { position: fixed; top: 60px; right: 16px; z-index: 70; background: rgba(35,42,60,0.98); border: 2px solid #ff6b6b; border-radius: 10px; padding: 10px 14px; font: 700 12px Rubik, sans-serif; color: #ff6b6b; box-shadow: 0 6px 18px rgba(0,0,0,0.4); }
    .cpu-warning.hidden { display: none; }
    .settings-panel { position: fixed; top: 56px; right: 12px; background: rgba(35,42,60,0.98); border: 2px solid rgba(255,255,255,0.2); border-radius: 12px; padding: 16px; z-index: 60; min-width: 180px; box-shadow: 0 8px 24px rgba(0,0,0,0.4); }
    .settings-panel.hidden { display: none; }
    .settings-panel h3 { margin-bottom: 12px; font: 700 14px Rubik, sans-serif; color: #7bed9f; }
    .settings-panel label { display: block; margin-bottom: 8px; font: 600 13px Rubik, sans-serif; color: rgba(255,255,255,0.9); cursor: pointer; }
    .settings-panel input[type="checkbox"] { margin-right: 8px; }
    .settings-close { margin-top: 12px; padding: 6px 12px; font: 600 12px Rubik, sans-serif; background: rgba(123,237,159,0.2); border: 1px solid #7bed9f; color: #7bed9f; border-radius: 6px; cursor: pointer; }
    #minimap-wrap {
      position: absolute; top: 56px; right: 12px; width: 132px; height: 132px;
      background: linear-gradient(145deg, rgba(25,30,45,0.95), rgba(18,22,35,0.95));
      border: 2px solid rgba(255,255,255,0.15); border-radius: 10px;
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.5), 0 4px 16px rgba(0,0,0,0.3);
      padding: 4px;
    }
    #minimap { width: 120px; height: 120px; border-radius: 6px; display: block; background: #2d4a2d; cursor: grab; }
    #minimap:active { cursor: grabbing; }
    .bottom-bar {
      position: absolute; bottom: 0; left: 0; right: 0; height: 72px;
      background: linear-gradient(0deg, rgba(30,35,50,0.97), rgba(22,26,38,0.97));
      border-top: 2px solid rgba(255,255,255,0.12);
      display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 6px;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.4);
    }
    #carried { font: 600 14px Rubik, sans-serif; color: #ffd93d; }
    #tag-cooldown { font: 600 12px Rubik, sans-serif; color: rgba(255,255,255,0.7); }
    #leaderboard {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      background: linear-gradient(145deg, rgba(35,42,60,0.98), rgba(25,30,45,0.98));
      border: 2px solid rgba(255,255,255,0.2); border-radius: 16px; padding: 28px 32px;
      font: 600 16px Rubik, sans-serif; color: #fff; display: none; max-width: 90%;
      box-shadow: 0 12px 40px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.08);
      z-index: 80; pointer-events: auto;
    }
    #leaderboard.show { display: block; }
    #leaderboard strong { display: block; margin-bottom: 16px; font-size: 20px; color: #7bed9f; }
    #connection-overlay {
      position: fixed; inset: 0; background: rgba(26,26,46,0.95); display: flex; flex-direction: column;
      align-items: center; justify-content: center; padding: 24px; text-align: center; z-index: 100;
      font: 600 16px Rubik, sans-serif; color: #fff;
    }
    #connection-overlay.hidden { display: none; }
    #connection-overlay h2 { color: #7bed9f; margin-bottom: 12px; font-size: 22px; }
    #connection-overlay p { max-width: 420px; line-height: 1.5; margin-bottom: 8px; color: rgba(255,255,255,0.9); }
    #connection-overlay code { background: rgba(0,0,0,0.3); padding: 2px 8px; border-radius: 4px; font-size: 14px; }
    #connection-overlay .error { color: #ff6b6b; margin-top: 16px; }
    #how-to-play {
      position: fixed; bottom: 80px; left: 12px; right: 12px; max-width: 360px; margin: 0 auto;
      background: rgba(35,42,60,0.95); border: 2px solid rgba(255,255,255,0.15); border-radius: 12px;
      padding: 14px 18px; font: 600 13px Rubik, sans-serif; color: rgba(255,255,255,0.95);
      line-height: 1.45; z-index: 50; box-shadow: 0 8px 24px rgba(0,0,0,0.4);
    }
    #how-to-play.hidden { display: none; }
    #how-to-play strong { color: #7bed9f; }
    /* Landing screen */
    #landing {
      position: fixed; inset: 0; background: #1a1a2e; z-index: 90;
      display: flex; flex-direction: column; overflow: auto;
    }
    #landing.hidden { display: none; }
    .landing-top {
      display: flex; align-items: center; justify-content: space-between; padding: 12px 20px;
      background: linear-gradient(180deg, rgba(30,35,50,0.97), rgba(22,26,38,0.97));
      border-bottom: 2px solid rgba(255,255,255,0.12);
    }
    .landing-top .logo { font: 700 20px/1 Rubik, sans-serif; color: #7bed9f; letter-spacing: 0.08em; }
    .landing-top .policy-links { display: flex; gap: 16px; flex-wrap: wrap; }
    .landing-top .policy-links a { font: 600 12px/1 Rubik, sans-serif; color: rgba(255,255,255,0.8); text-decoration: none; }
    .landing-top .policy-links a:hover { color: #7bed9f; }
    .landing-main {
      flex: 1; display: flex; align-items: stretch; justify-content: center; gap: 24px; padding: 24px;
      flex-wrap: wrap;
    }
    .landing-left, .landing-center, .landing-right {
      background: rgba(35,42,60,0.6); border: 2px solid rgba(255,255,255,0.12); border-radius: 12px;
      padding: 20px; min-width: 200px;
    }
    .landing-left { max-width: 240px; }
    .landing-center { flex: 1; max-width: 420px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
    .landing-right { max-width: 220px; }
    .landing-left h3, .landing-right h3 { font: 700 14px Rubik, sans-serif; color: #7bed9f; margin-bottom: 12px; }
    .landing-profile-name { font: 600 16px/1 Rubik, sans-serif; color: #fff; margin-bottom: 8px; }
    .landing-profile-avatar { width: 56px; height: 56px; border-radius: 50%; background: rgba(123,237,159,0.2); border: 2px solid #7bed9f; margin-bottom: 12px; display: flex; align-items: center; justify-content: center; font: 700 24px Rubik, sans-serif; color: #7bed9f; }
    .landing-center .title { font: 700 28px/1 Rubik, sans-serif; color: #7bed9f; margin-bottom: 16px; letter-spacing: 0.05em; }
    .landing-center .nick-row { margin-bottom: 16px; }
    .landing-center .nick-row label { font: 600 12px Rubik, sans-serif; color: rgba(255,255,255,0.8); display: block; margin-bottom: 4px; }
    .landing-center .nick-row input { padding: 8px 12px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.3); color: #fff; font: 600 14px Rubik, sans-serif; width: 180px; }
    .landing-center .landing-music-row { margin-bottom: 12px; }
    .landing-center .landing-music-row label { font: 600 13px Rubik, sans-serif; color: rgba(255,255,255,0.9); cursor: pointer; display: inline-flex; align-items: center; gap: 8px; }
    .landing-center .landing-music-row input[type="checkbox"] { margin: 0; }
    .landing-center .play-btn { padding: 14px 48px; font: 700 18px Rubik, sans-serif; background: #7bed9f; color: #1a1a2e; border: none; border-radius: 10px; cursor: pointer; margin: 16px 0; box-shadow: 0 4px 16px rgba(123,237,159,0.4); }
    .landing-center .play-btn:hover { background: #9bffbf; }
    .landing-center .auth-buttons { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin: 12px 0; }
    .landing-center .auth-buttons a { font: 600 13px Rubik, sans-serif; color: rgba(255,255,255,0.9); text-decoration: none; padding: 8px 16px; border: 2px solid rgba(255,255,255,0.3); border-radius: 8px; }
    .landing-center .auth-buttons a:hover { border-color: #7bed9f; color: #7bed9f; }
    .landing-center .hint { font: 600 12px/1.4 Rubik, sans-serif; color: rgba(255,255,255,0.7); margin-top: 16px; max-width: 320px; }
    .landing-right .mode-option { display: block; margin-bottom: 10px; padding: 10px 14px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.2); cursor: pointer; font: 600 13px Rubik, sans-serif; color: rgba(255,255,255,0.9); text-align: left; }
    .landing-right .mode-option:hover { border-color: rgba(255,255,255,0.4); }
    .landing-right .mode-option.selected { border-color: #7bed9f; background: rgba(123,237,159,0.15); color: #7bed9f; }
    .landing-shop { margin-top: 16px; }
    .landing-money { font: 600 14px Rubik, sans-serif; color: #7bed9f; margin-bottom: 8px; }
    .landing-buy { display: block; width: 100%; margin-bottom: 6px; padding: 8px 10px; font: 600 12px Rubik, sans-serif; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.3); border-radius: 6px; color: #fff; cursor: pointer; }
    .landing-buy:hover { border-color: #7bed9f; color: #7bed9f; }
    .landing-buy:disabled { opacity: 0.5; cursor: not-allowed; }
    #cookie-banner {
      position: fixed; bottom: 0; left: 0; right: 0; z-index: 200;
      background: rgba(30,35,50,0.98); border-top: 2px solid rgba(255,255,255,0.15);
      padding: 14px 20px; display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 12px;
      font: 600 13px/1.4 Rubik, sans-serif; color: rgba(255,255,255,0.9);
    }
    #cookie-banner.hidden { display: none; }
    #cookie-banner a { color: #7bed9f; text-decoration: none; }
    #cookie-banner a:hover { text-decoration: underline; }
    #cookie-banner .cookie-btns { display: flex; gap: 10px; margin-left: 8px; }
    #cookie-banner button { padding: 8px 16px; font: 600 12px Rubik, sans-serif; border-radius: 8px; cursor: pointer; border: none; }
    #cookie-banner .cookie-accept { background: #7bed9f; color: #1a1a2e; }
    #cookie-banner .cookie-essential { background: rgba(255,255,255,0.2); color: #fff; border: 1px solid rgba(255,255,255,0.4); }
  </style>
</head>
<body>
  <div id="cookie-banner" class="hidden">
    <span>We use cookies for session and preferences. <a href="privacy.html">Privacy Policy</a> <a href="cookies.html">Cookie Policy</a>.</span>
    <span class="cookie-btns"><button type="button" id="cookie-accept" class="cookie-accept">Accept</button><button type="button" id="cookie-essential" class="cookie-essential">Essential only</button></span>
  </div>
  <div id="landing">
    <header class="landing-top">
      <span class="logo">Adoptar.io</span>
      <nav class="policy-links">
        <a href="privacy.html">Privacy</a>
        <a href="cookies.html">Cookies</a>
        <a href="terms.html">Terms</a>
        <a href="contact.html">Contact</a>
        <a href="privacy-settings.html">Privacy settings</a>
      </nav>
    </header>
    <main class="landing-main">
      <aside class="landing-left">
        <h3>Player</h3>
        <div id="landing-profile-avatar" class="landing-profile-avatar" aria-hidden="true">?</div>
        <div id="landing-profile-name" class="landing-profile-name">Guest</div>
        <p class="landing-guest-hint" style="font-size:11px;color:rgba(255,255,255,0.7);margin-bottom:12px">Play to earn money. Boosts apply this match. Sign in to save progress.</p>
        <div id="landing-profile-actions"></div>
        <div class="landing-shop">
          <div id="landing-money" class="landing-money">Money: 0</div>
          <button type="button" class="landing-buy" data-boost="size">Buy +1 size (50)</button>
          <button type="button" class="landing-buy" data-boost="speed">Buy speed (30)</button>
          <button type="button" class="landing-buy" data-boost="adoptSpeed">Buy adopt speed (40)</button>
        </div>
      </aside>
      <section class="landing-center">
        <h1 class="title">Adoptar.io</h1>
        <div class="nick-row">
          <label for="landing-nick">Nick</label>
          <input type="text" id="landing-nick" placeholder="Nickname" maxlength="24" autocomplete="off" />
        </div>
        <div class="landing-music-row">
          <label><input type="checkbox" id="landing-music-toggle" checked /> Music</label>
        </div>
        <button type="button" id="landing-play" class="play-btn">Play</button>
        <div class="auth-buttons" id="landing-auth-buttons">
          <a href="/auth/google">Sign in with Google</a>
          <a href="#" id="landing-facebook" style="opacity:0.7">Sign in with Facebook</a>
        </div>
        <p class="hint">WASD or tap to move. Collect strays, bring to Adoption Center to grow.</p>
      </section>
      <aside class="landing-right">
        <h3>Game Mode</h3>
        <button type="button" class="mode-option selected" data-mode="ffa">FFA</button>
        <button type="button" class="mode-option" data-mode="teams">Teams</button>
        <button type="button" class="mode-option" data-mode="solo">Solo / vs CPU</button>
      </aside>
    </main>
  </div>
  <div id="connection-overlay" class="hidden">
    <h2>Connecting…</h2>
    <p>Waiting for game server. If this doesn’t go away, the server isn’t running.</p>
    <p>From the project root run: <code>npm run dev</code></p>
    <p>That starts both the server (ports 4000, 4001) and this client (3000).</p>
  </div>
  <div id="game-wrap">
  <canvas id="game"></canvas>
  <div id="ui">
    <div class="top-bar">
      <span class="score" id="score">Size: 1</span>
      <span class="game-title">Adoptar.io</span>
      <span class="timer" id="timer">5:00</span>
      <span id="ping" class="ping-display"></span>
      <div id="auth-area"></div>
      <button type="button" id="settings-btn" class="settings-btn" title="Settings" aria-label="Settings">&#9881;</button>
    </div>
    <div id="settings-panel" class="settings-panel hidden">
      <h3>Settings</h3>
      <label><input type="checkbox" id="music-toggle" checked /> Music</label>
      <label><input type="checkbox" id="sfx-toggle" checked /> Sound effects</label>
      <button type="button" id="settings-close" class="settings-close">Close</button>
    </div>
    <div id="switch-server" class="switch-server hidden">
      <p>High latency. Switch server?</p>
      <button type="button" id="switch-server-btn" class="switch-server-btn">Switch server</button>
    </div>
    <div id="minimap-wrap"><canvas id="minimap" width="120" height="120"></canvas></div>
    <div class="bottom-bar">
      <span id="carried"></span>
      <span id="tag-cooldown">Adoptions: 0</span>
    </div>
    <div id="leaderboard"></div>
    <div id="lobby-overlay" class="lobby-overlay hidden">
      <p id="lobby-message" class="lobby-message">Waiting for another player…</p>
      <p id="lobby-countdown" class="lobby-countdown hidden"></p>
      <button type="button" id="lobby-ready-btn" class="fight-ally-btn ally-btn hidden">Ready</button>
      <button type="button" id="lobby-back-btn" class="fight-ally-btn fight-btn" style="margin-top:12px">Back to lobby</button>
    </div>
    <div id="fight-ally-overlay" class="fight-ally-overlay hidden">
      <p class="fight-ally-title">Shelters touching</p>
      <p id="fight-ally-name" class="fight-ally-name"></p>
      <div class="fight-ally-btns">
        <button type="button" id="fight-ally-fight" class="fight-ally-btn fight-btn">Fight</button>
        <button type="button" id="fight-ally-ally" class="fight-ally-btn ally-btn">Ally</button>
      </div>
    </div>
    <div id="cpu-warning" class="cpu-warning hidden">CPU attacking!</div>
    <div id="how-to-play" class="hidden">
      <strong>You are a shelter.</strong> WASD or tap to move. Collect <strong>strays</strong> (brown) — you can hold as many as your size. Bring them to the <strong>Adoption Center</strong> (green circle) to adopt out and <strong>grow</strong>. Green orbs = +size, blue = speed boost.
    </div>
  </div>
  </div>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <script type="module" src="/src/main.ts"></script>
</body>
</html>
