# Rescueworld (Puppy Rescue) â€“ insert these locations into the games.vo.ly server block
# in /etc/nginx/sites-enabled/cdr (after the "Block common attack" location, before /api).
# After merging: sudo nginx -t && sudo systemctl reload nginx

# Rescueworld: signaling (matchmaking) WebSocket
location /ws-signaling {
    proxy_pass http://127.0.0.1:4000;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_read_timeout 86400;
    proxy_send_timeout 86400;
}

# Rescueworld: game WebSocket
location /ws-game {
    proxy_pass http://127.0.0.1:4001;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_read_timeout 86400;
    proxy_send_timeout 86400;
}

# Rescueworld: static client (Puppy Rescue) at https://games.vo.ly/rescueworld/
location = /rescueworld {
    return 301 /rescueworld/;
}
location /rescueworld/ {
    alias /srv/www/games/io/rescueworld/client/dist/;
    try_files $uri $uri/ /rescueworld/index.html;
}

# Rescueworld: public marketing assets at /marketing/
# Images, GIFs, and video clips for social media / embeds
location = /marketing {
    return 301 /marketing/;
}
location ^~ /marketing/ {
    root /srv/www/games/io/rescueworld;
    autoindex off;
    try_files $uri =404;

    # Cache static assets aggressively (images, gifs, video)
    expires 7d;
    add_header Cache-Control "public, immutable";

    # Allow embedding / hotlinking from any origin
    add_header Access-Control-Allow-Origin "*";
    add_header Access-Control-Allow-Methods "GET, HEAD, OPTIONS";
}
