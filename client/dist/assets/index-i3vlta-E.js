(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function s(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(i){if(i.ep)return;i.ep=!0;const r=s(i);fetch(i.href,r)}})();const Jo=25,Ki=1e3/Jo,V=4800,ne=4800,fo=280,ct=32,dt=2.5,Tn=140,uo=10,ho=18,ji=1.5,Vo=50,Ne=1,$e=2,Oe=4,De=8,Ji=0,Vi=1,Zo=2,Qo=3,ei=4,Le=0,Hs=1,qs=2,Xs=3,Qn=4,Zi=1,ti=2;function ni(e,t){const s=new ArrayBuffer(4),o=new DataView(s);return o.setUint8(0,Zi),o.setUint16(1,e,!0),o.setUint8(3,t&255),s}function ce(e,t){const s=e.getUint8(t);if(s===0)return{s:"",next:t+1};const o=e.buffer.byteLength-(t+1);if(s>o||s<0)throw new RangeError(`Snapshot string length ${s} exceeds buffer (${o} bytes left)`);const i=new Uint8Array(e.buffer,t+1,s);return{s:new TextDecoder().decode(i),next:t+1+s}}function Qi(e){const t=new DataView(e);let s=0;if(t.getUint8(s++)!==ti)throw new Error("Invalid snapshot message");const o=t.getUint32(s,!0);s+=4;const i=t.getUint32(s,!0);s+=4;const r=t.getUint8(s++)!==0,{s:c,next:l}=ce(t,s);s=l;const f=t.getUint32(s,!0);s+=4;const y=t.getUint8(s++),h=t.getUint32(s,!0);s+=4;const k=t.getUint8(s++),R=[];for(let N=0;N<k;N++){const{s:U,next:Y}=ce(t,s);s=Y;const{s:q,next:F}=ce(t,s);s=F;const X=t.getFloat32(s,!0);s+=4;const G=t.getFloat32(s,!0);s+=4;const z=t.getFloat32(s,!0);s+=4;const le=t.getFloat32(s,!0);s+=4;const he=t.getFloat32(s,!0);s+=4;const pe=t.getUint32(s,!0);s+=4;const vt=t.getUint8(s++),je=[];for(let Ve=0;Ve<vt;Ve++){const{s:qt,next:Xt}=ce(t,s);s=Xt,je.push(qt)}const Ye=t.getUint32(s,!0);s+=4;const Et=t.getUint8(s++),zt=t.getUint8(s++)!==0,Je=t.getUint8(s++)!==0,be=t.getUint8(s++),Wt=t.getUint8(s++),wt=[];for(let Ve=0;Ve<Wt;Ve++){const{s:qt,next:Xt}=ce(t,s);s=Xt,wt.push(qt)}const{s:mn,next:ro}=ce(t,s);s=ro;const rs=t.getUint16(s,!0);s+=2;const{s:yn,next:ls}=ce(t,s);s=ls;const Ht=t.getUint8(s++)!==0;R.push({id:U,displayName:q||U,x:X,y:G,vx:z,vy:le,size:he,totalAdoptions:pe,petsInside:je,speedBoostUntil:Ye,inputSeq:Et,...wt.length?{allies:wt}:{},...zt?{eliminated:!0}:{},...Je?{grounded:!0}:{},...be>0?{portCharges:be}:{},...mn?{shelterColor:mn}:{},...rs>0?{money:rs}:{},...yn?{shelterId:yn}:{},...Ht?{vanSpeedUpgrade:!0}:{}})}const u=t.getUint16(s,!0);s+=2;const v=[];for(let N=0;N<u;N++){const{s:U,next:Y}=ce(t,s);s=Y;const q=t.getFloat32(s,!0);s+=4;const F=t.getFloat32(s,!0);s+=4;const X=t.getFloat32(s,!0);s+=4;const G=t.getFloat32(s,!0);s+=4;const{s:z,next:le}=ce(t,s);s=le;const he=z===""?null:z,pe=s<t.byteLength?t.getUint8(s++):0;v.push({id:U,x:q,y:F,vx:X,vy:G,insideShelterId:he,petType:pe})}const b=t.getUint8(s++),B=[];for(let N=0;N<b;N++){const{s:U,next:Y}=ce(t,s);s=Y;const q=t.getFloat32(s,!0);s+=4;const F=t.getFloat32(s,!0);s+=4;const X=t.getFloat32(s,!0);s+=4,B.push({id:U,x:q,y:F,radius:X})}const m=t.getUint8(s++),A=[];for(let N=0;N<m;N++){const{s:U,next:Y}=ce(t,s);s=Y;const q=t.getFloat32(s,!0);s+=4;const F=t.getFloat32(s,!0);s+=4;const X=t.getUint8(s++),G=t.getUint8(s++);A.push({id:U,x:q,y:F,type:X,level:G>0?G:void 0})}const D=t.getUint8(s++),M=[];for(let N=0;N<D;N++){const{s:U,next:Y}=ce(t,s);s=Y;const{s:q,next:F}=ce(t,s);s=F;const X=t.getFloat32(s,!0);s+=4;const G=t.getFloat32(s,!0);s+=4;const z=t.getUint8(s++),le=(z&1)!==0,he=(z&2)!==0,pe=(z&4)!==0,vt=t.getUint8(s++),je=[];for(let Je=0;Je<vt;Je++){const{s:be,next:Wt}=ce(t,s);s=Wt,je.push(be)}const Ye=t.getFloat32(s,!0);s+=4;const Et=t.getUint32(s,!0);s+=4;const zt=s<t.byteLength?t.getUint8(s++):Ye<100?1:Ye<250?2:Ye<500?3:Ye<1e3?4:5;M.push({id:U,ownerId:q,x:X,y:G,hasAdoptionCenter:le,hasGravity:he,hasAdvertising:pe,petsInside:je,size:Ye,totalAdoptions:Et,tier:zt})}const H=s<t.byteLength?t.getUint8(s++):0,j=[];for(let N=0;N<H;N++){const{s:U,next:Y}=ce(t,s);s=Y;const q=t.getFloat32(s,!0);s+=4;const F=t.getFloat32(s,!0);s+=4;const X=t.getUint8(s++),G=t.getFloat32(s,!0);s+=4,j.push({id:U,x:q,y:F,level:X,size:G})}return{tick:o,matchEndAt:i,matchEndedEarly:r||void 0,winnerId:c||void 0,totalMatchAdoptions:f,scarcityLevel:y>0?y:void 0,matchDurationMs:h,players:R,pets:v,adoptionZones:B,pickups:A,shelters:M.length>0?M:void 0,breederShelters:j.length>0?j:void 0}}const si="rescueworld_music",oi="rescueworld_sfx";function ii(e,t){try{const s=localStorage.getItem(e);if(s==="0"||s==="false")return!1;if(s==="1"||s==="true")return!0}catch{}return t}function ai(e,t){try{localStorage.setItem(e,t?"1":"0")}catch{}}function Dt(){return ii(si,!0)}function ri(e){ai(si,e),te&&(te.volume=e?1:0),!e&&te&&te.pause()}function li(){return ii(oi,!0)}function ea(e){ai(oi,e)}let gn=null;function ta(){if(gn)return gn;try{gn=new(window.AudioContext||window.webkitAudioContext)}catch{return null}return gn}function ae(e,t,s="sine",o=.3){if(!li())return;const i=ta();if(i)try{const r=i.createOscillator(),c=i.createGain();r.connect(c),c.connect(i.destination),r.frequency.value=e,r.type=s,c.gain.setValueAtTime(o,i.currentTime),c.gain.exponentialRampToValueAtTime(.001,i.currentTime+t),r.start(i.currentTime),r.stop(i.currentTime+t)}catch{}}function $n(){ae(523,.12,"sine",.25),setTimeout(()=>ae(659,.1,"sine",.2),80)}function na(){ae(440,.08,"square",.2),setTimeout(()=>ae(880,.08,"square",.15),60)}function sa(){ae(392,.1,"sine",.25),setTimeout(()=>ae(523,.12,"sine",.22),70),setTimeout(()=>ae(659,.15,"sine",.2),140)}function oa(){ae(330,.06,"sine",.18)}function ia(){ae(523,.15,"sine",.25),setTimeout(()=>ae(659,.15,"sine",.22),120),setTimeout(()=>ae(784,.2,"sine",.2),240)}function aa(){ae(440,.08,"sine",.2),setTimeout(()=>ae(554,.08,"sine",.18),80),setTimeout(()=>ae(659,.12,"sine",.2),160)}function On(){ae(220,.15,"sawtooth",.35),setTimeout(()=>ae(180,.12,"sawtooth",.3),100),setTimeout(()=>ae(220,.1,"sawtooth",.25),200)}let te=null;function ra(){var o;const e=import.meta;let t=typeof((o=e.env)==null?void 0:o.BASE_URL)=="string"?e.env.BASE_URL:"";if(!t||t==="/"){const i=typeof window<"u"?window.location.pathname:"";if(i.includes("rescueworld"))t="/rescueworld/";else{const r=i.lastIndexOf("/");t=r<=0?"/":i.slice(0,r+1)}}return t.endsWith("/")?`${t}music.mp3`:`${t}/music.mp3`}function un(){if(Dt())try{if(!te){te=new Audio,te.loop=!0,te.volume=1,te.preload="auto",te.src=ra();let t=!1;te.addEventListener("error",()=>{!te||t||(t=!0,te.src="/rescueworld/music.mp3",te.play().catch(()=>{}))}),te.load()}te.volume=Dt()?1:0;const e=te.play();e&&typeof e.catch=="function"&&e.catch(()=>{})}catch{}}const Jt=new Image;let ci=!1;function la(){const e=["/breeder-mill.png","/rescueworld/breeder-mill.png"];let t=0;const s=()=>{if(t>=e.length){console.error("Failed to load breeder-mill.png from all paths");return}Jt.src=e[t],t++};Jt.onload=()=>{ci=!0},Jt.onerror=()=>{console.warn("Failed to load breeder-mill.png from",Jt.src),s()},s()}la();const He=new Image;let di=!1;function ca(){const e=["/adoption-event.png","/rescueworld/adoption-event.png"];let t=0;const s=()=>{if(t>=e.length){console.error("[AdoptionEvent] Failed to load adoption-event.png from all paths:",e);return}const o=e[t];console.log(`[AdoptionEvent] Attempting to load image from: ${o}`),He.src=o,t++};He.onload=()=>{di=!0,console.log(`[AdoptionEvent] Image loaded successfully from: ${He.src} (${He.width}x${He.height})`)},He.onerror=o=>{console.error(`[AdoptionEvent] Failed to load from ${He.src}:`,o),s()},s()}ca();const da=(()=>{const{protocol:e,host:t}=window.location;return`${e==="https:"?"wss:":"ws:"}//${t}/ws-signaling`})();let ln=0,fi=0;const Z={};let Ft=!1,Dn=0,_n=0,es=0,ts=0;const fa=15,mo=60;let d=null,P=null,a=null;const Un=new Map,Fn=new Map,ua=100;let x=null,fs=0,us=0,yo=0,go=[],po=[];const hs=new Map;let bo=0,Bt=!1,on=!1,ui=0,Ts=0,ms=0,pn=null,Bs=null,an=null;const ha=200,L=document.getElementById("game"),n=L.getContext("2d"),Ce=document.getElementById("minimap"),w=Ce.getContext("2d"),ma=document.getElementById("score"),ys=document.getElementById("event-panel"),vo=document.getElementById("event-panel-list"),ya=document.getElementById("carried"),Eo=document.getElementById("tag-cooldown"),ga=document.getElementById("timer"),pa=document.getElementById("game-clock"),Fe=document.getElementById("leaderboard"),oe=document.getElementById("connection-overlay"),ba=document.getElementById("how-to-play"),va=document.getElementById("settings-btn"),Gs=document.getElementById("settings-panel"),Ea=document.getElementById("exit-to-lobby-btn"),Mt=document.getElementById("music-toggle"),Ms=document.getElementById("sfx-toggle"),wa=document.getElementById("settings-close");document.getElementById("ping");const Sa=document.getElementById("switch-server"),Ia=document.getElementById("switch-server-btn"),xe=document.getElementById("auth-area"),ns=document.getElementById("landing"),cn=document.getElementById("game-wrap"),xa=document.getElementById("landing-play"),re=document.getElementById("landing-nick"),Ee=document.getElementById("nick-save-btn"),We=document.getElementById("nick-hint"),Kt=document.getElementById("landing-music-toggle"),Pt=document.getElementById("landing-profile-name"),At=document.getElementById("landing-profile-avatar"),gs=document.getElementById("landing-profile-actions"),ps=document.getElementById("landing-auth-buttons"),ft=document.getElementById("referral-status"),bs=document.getElementById("referral-link"),Ps=document.getElementById("referral-copy-btn"),Bn=document.getElementById("referral-claim-btn"),Ks=document.getElementById("cookie-banner"),ka=document.getElementById("cookie-accept"),La=document.getElementById("cookie-essential"),Vt=document.getElementById("fight-ally-overlay"),Ca=document.getElementById("fight-ally-name"),Ta=document.getElementById("fight-ally-fight"),Ba=document.getElementById("fight-ally-ally"),bn=document.getElementById("cpu-warning"),Yn=document.getElementById("action-menu"),Ma=document.getElementById("action-menu-close"),Pa=document.getElementById("action-size-text"),Aa=document.getElementById("action-size-bar"),Ra=document.getElementById("action-tokens-text"),Na=document.getElementById("action-tokens-bar"),qe=document.getElementById("action-build-btn"),wo=document.getElementById("action-build-shelter"),vn=document.getElementById("action-adoption-center"),En=document.getElementById("action-gravity"),wn=document.getElementById("action-advertising"),So=document.getElementById("action-van-speed"),Zt=document.getElementById("action-adoption-btn"),Qt=document.getElementById("action-gravity-btn"),en=document.getElementById("action-advertising-btn"),tn=document.getElementById("action-van-speed-btn"),As=document.getElementById("ground-btn"),Mn=document.getElementById("port-btn"),Pn=document.getElementById("shelter-port-btn"),it=document.getElementById("transfer-btn"),nn=document.getElementById("build-shelter-btn"),zn=document.getElementById("center-van-btn"),rn=document.getElementById("center-shelter-btn"),$a=document.getElementById("game-tokens"),xt=document.getElementById("lobby-overlay"),Rs=document.getElementById("lobby-message"),vs=document.getElementById("lobby-player-list"),Es=document.getElementById("lobby-countdown"),Lt=document.getElementById("lobby-ready-btn"),Oa=document.getElementById("lobby-back-btn"),sn=document.getElementById("lobby-gift-btn"),Ns=document.getElementById("breeder-minigame"),Da=document.getElementById("breeder-timer"),_a=document.getElementById("breeder-tokens"),Io=document.getElementById("breeder-pets"),Ge=document.getElementById("breeder-foods"),hi=document.getElementById("breeder-result"),Ua=document.getElementById("breeder-result-title"),mi=document.getElementById("breeder-rewards"),Fa=document.getElementById("breeder-close-btn"),yi=document.getElementById("daily-gift-modal"),Ya=document.getElementById("daily-gift-close"),ws=document.getElementById("daily-gift-subtitle"),xo=document.getElementById("daily-gift-grid"),nt=document.getElementById("daily-gift-claim-btn"),st=document.getElementById("daily-gift-btn"),za=document.getElementById("server-clock-time"),ko=document.getElementById("server-clock-next-gift"),gi=document.getElementById("leaderboard-modal"),Wa=document.getElementById("leaderboard-close"),Wn=document.getElementById("leaderboard-content"),Ct=document.getElementById("leaderboard-my-rank"),Ha=document.getElementById("leaderboard-btn"),qa=document.getElementById("equip-rt"),Xa=document.getElementById("equip-ports"),Ga=document.getElementById("equip-speed"),Ka=document.getElementById("equip-size"),jt=document.getElementById("equip-note");let Pe={storedRt:0,portCharges:0,speedBoosts:0,sizeBoosts:0,signedIn:!1};const p={active:!1,pets:[],selectedPetIndex:null,timeLeft:30,timerInterval:null,addPetInterval:null,totalPets:0,rescuedCount:0,level:1,selectedIngredients:[]},pi={apple:5,carrot:8,chicken:15,seeds:5,water:20,bowl:20},ja={apple:["horse","rabbit"],carrot:["horse","bird","rabbit"],chicken:["dog","cat"],seeds:["bird"],water:[],bowl:[]},Ja={2:[{ingredients:["chicken","carrot"],worksOn:["dog","cat"]},{ingredients:["seeds","apple"],worksOn:["bird"]},{ingredients:["apple","carrot"],worksOn:["horse","rabbit"]}],3:[{ingredients:["water","chicken","carrot"],worksOn:["dog","cat"]},{ingredients:["water","seeds","apple"],worksOn:["bird"]},{ingredients:["water","apple","carrot"],worksOn:["horse","rabbit"]}],4:[{ingredients:["bowl","water","chicken","carrot"],worksOn:["dog","cat"]},{ingredients:["bowl","water","seeds","apple"],worksOn:["bird"]},{ingredients:["bowl","water","apple","carrot"],worksOn:["horse","rabbit"]}]};function hn(e){return e<=2?1:e<=5?2:e<=9?3:4}const Va={dog:"üêï",cat:"üê±",horse:"üê¥",bird:"üê¶",rabbit:"üê∞"},js="cookieConsent",bi="rescueworld_mode",vi="rescueworld_ref",Za="rescueworld_skin_unlocked";let at=null;const $s=new Set,Hn=new Set;let Sn=0;const Lo=2e3,Co=new Map,dn=new Map,Os=400,To=new Map,An=[],Bo=800,Qa={[Le]:"üêà",[Hs]:"üêï",[qs]:"üê¶",[Xs]:"üê∞",[Qn]:"‚≠ê"};let er=0;function Mo(e,t,s,o,i){const r=Date.now();for(let c=0;c<i.length;c++){const l=i[c]??Le,f=c*100,y=(Math.random()-.5)*30,h=(Math.random()-.5)*30;An.push({id:`adopt-${er++}`,startTime:r+f,fromX:e+y,fromY:t+h,toX:s,toY:o,petType:l})}}let K="playing",Ss=0,tr=0,qn=!1;const Ei="rescueworld_tokens",Js="rescueworld_color",wi="rescueworld_unlocked_colors",Xn={size:50,speed:30,adoptSpeed:40},Gn={preset:50,custom:200,gradient:500};let ie="ffa",Xe=!1;const ue={sizeBonus:0,speedBoost:!1,adoptSpeed:!1};let we=null,fe=!1,Vs=null,nr=null;function Ie(){return parseInt(localStorage.getItem(Ei)||"0",10)}function mt(e){localStorage.setItem(Ei,String(Math.max(0,e)))}function Te(){const e=document.getElementById("landing-tokens");e&&(e.textContent=`Tokens: ${Ie()} RT`);const t=Ie();document.querySelectorAll(".landing-buy").forEach(s=>{const o=s.dataset.boost;if(!o||!(o in Xn))return;const i=Xn[o];s.disabled=t<i||o==="speed"&&ue.speedBoost||o==="adoptSpeed"&&ue.adoptSpeed})}function Si(){return localStorage.getItem(Js)||"#7bed9f"}function _t(e){localStorage.setItem(Js,e),fe&&fetch("/auth/profile",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({shelterColor:e})}).catch(()=>{})}function ss(){try{const e=localStorage.getItem(wi);if(e)return JSON.parse(e)}catch{}return{preset:!1,custom:null,gradient:null}}function Ds(e){localStorage.setItem(wi,JSON.stringify(e))}function ut(){const e=Si(),t=ss(),s=Ie();document.querySelectorAll(".color-btn").forEach(i=>{const r=i.dataset.color;i.classList.toggle("selected",r===e)});const o=document.getElementById("preset-colors-row");o&&(o.style.display=t.preset?"flex":"none",o.querySelectorAll(".preset-color").forEach(i=>{const r=i.dataset.color;i.classList.toggle("selected",r===e)})),document.querySelectorAll(".color-buy").forEach(i=>{const r=i.dataset.color,c=Gn[r],l=r==="preset"?t.preset:r==="custom"?!!t.custom:!!t.gradient;i.disabled=l||s<c,i.classList.toggle("unlocked",l),l&&(r==="preset"?i.textContent="Preset Colors Unlocked":r==="custom"?i.textContent="Custom Color: Click to use":r==="gradient"&&(i.textContent="Gradient: Click to use"))})}let Is=null;function se(e,t="info"){let s=document.getElementById("toast");s||(s=document.createElement("div"),s.id="toast",s.className="toast",document.body.appendChild(s)),s.textContent=e,s.classList.remove("toast-success","toast-error","toast-info"),s.classList.add(`toast-${t}`),t==="success"?s.style.background="linear-gradient(135deg, #2ecc71 0%, #27ae60 100%)":t==="error"?s.style.background="linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)":s.style.background="linear-gradient(135deg, #3498db 0%, #2980b9 100%)",s.classList.add("show"),Is&&clearTimeout(Is),Is=setTimeout(()=>{s.classList.remove("show")},3e3)}const ht=[];let ye=null,Rn=!1;function sr(e){for(ht.push(...e);ht.length>3;)ht.shift();Ii()}function or(){ht.length=0,Rn=!1,ye&&(ye.style.display="none",ye.innerHTML="")}function Ii(){if(Rn||ht.length===0)return;const e=ht.shift();Rn=!0;const t=["rescued","shut down","destroyed","saved","stopped","is shutting down","farmers market","school fair","petco","stadium","event started","partial win","dropped off","instant adoption","won "],s=["arrived","appeared","failed","formed","expanding","breeding","warning","danger","urgent","critical","strays on the map","game over at"],o=e.toLowerCase(),i=t.some(k=>o.includes(k)),r=s.some(k=>o.includes(k)),c=i&&!r||!r&&(o.includes("event")||o.includes("adoption")),l=c?"rgba(46,204,113,":"rgba(255,107,107,",f=c?"rgba(46,204,113,0.8)":"rgba(255,107,107,0.8)",y=c?"‚úÖ":"‚ö†Ô∏è";ye||(ye=document.createElement("div"),ye.id="announcement-bar",document.body.appendChild(ye)),ye.style.cssText=`
    position: fixed;
    top: 60px;
    left: 0;
    width: 100%;
    height: 40px;
    background: linear-gradient(90deg, ${l}0) 0%, ${l}0.4) 15%, ${l}0.4) 85%, ${l}0) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    z-index: 150;
    pointer-events: none;
  `;const h=document.createElement("div");if(h.style.cssText=`
    white-space: nowrap;
    font: bold 18px 'Rubik', sans-serif;
    color: #fff;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.8), 0 0 10px ${f};
    animation: announcementScroll 8s linear forwards;
  `,h.textContent=`${y} ${e} ${y}`,!document.getElementById("announcement-keyframes")){const k=document.createElement("style");k.id="announcement-keyframes",k.textContent=`
      @keyframes announcementScroll {
        0% { transform: translateX(100vw); opacity: 0; }
        5% { opacity: 1; }
        95% { opacity: 1; }
        100% { transform: translateX(-100vw); opacity: 0; }
      }
    `,document.head.appendChild(k)}ye.style.display="flex",ye.innerHTML="",ye.appendChild(h),h.addEventListener("animationend",()=>{Rn=!1,ht.length===0&&ye&&(ye.style.display="none"),Ii()})}const Kn=document.getElementById("ally-request-popup"),Po=document.getElementById("ally-requester-name"),Ao=document.getElementById("ally-accept-btn"),Ro=document.getElementById("ally-deny-btn");let jn=null,Rt=null;function ir(e,t){!Kn||!Po||(jn=e,Po.textContent=t,Kn.classList.remove("hidden"),Rt&&clearTimeout(Rt),Rt=setTimeout(()=>{xi()},1e4))}function xi(){Kn&&Kn.classList.add("hidden"),jn=null,Rt&&(clearTimeout(Rt),Rt=null)}function ki(e){!jn||!d||d.readyState!==WebSocket.OPEN||(d.send(JSON.stringify({type:"allyResponse",targetId:jn,accept:e})),xi())}Ao&&Ao.addEventListener("click",()=>ki(!0));const No=document.getElementById("transfer-confirm-popup");document.getElementById("transfer-confirm-count");const $o=document.getElementById("transfer-confirm-btn"),Oo=document.getElementById("transfer-cancel-btn");let _s=null;function Zs(){No&&No.classList.add("hidden"),_s=null}$o&&$o.addEventListener("click",()=>{!d||d.readyState!==WebSocket.OPEN||!_s||(d.send(JSON.stringify({type:"transferPets",targetShelterId:_s})),Zs())});Oo&&Oo.addEventListener("click",Zs);Ro&&Ro.addEventListener("click",()=>ki(!1));const Jn=document.getElementById("abandon-confirm-popup"),Do=document.getElementById("abandon-confirm-btn"),_o=document.getElementById("abandon-cancel-btn");let Vn=null;function ar(e){Jn&&(Vn=e,Jn.classList.remove("hidden"))}function Li(){Jn&&Jn.classList.add("hidden"),Vn=null}Do&&Do.addEventListener("click",()=>{Vn&&Vn(),Li()});_o&&_o.addEventListener("click",Li);function rr(){const e=window.location.pathname;if(e.includes("rescueworld"))return"/rescueworld/";const t=e.lastIndexOf("/");return t<=0?"/":e.slice(0,t+1)}function lr(){try{const e=new URL(window.location.href),t=e.searchParams.get("ref");t&&(localStorage.setItem(vi,t),e.searchParams.delete("ref"),window.history.replaceState({},document.title,e.toString()))}catch{}}function cr(){try{const e=localStorage.getItem(vi);return e&&e.length?e:null}catch{return null}}function kt(e){const t=cr();return t?`${e}?ref=${encodeURIComponent(t)}`:e}function Ci(e){const t=rr();return`${window.location.origin}${t}?ref=${encodeURIComponent(e)}`}let ge=null;async function Ti(){if(!fe){ge=null;return}try{const e=await fetch("/referrals/me",{credentials:"include"});if(!e.ok){ge=null;return}ge=await e.json()}catch{ge=null}}function Bi(){if(!fe||!ge){ft.textContent="Sign in to get your referral link.",bs.classList.add("referral-hidden"),Ps.classList.add("referral-hidden"),Bn.classList.add("referral-hidden");return}const e=Ci(ge.referralCode);ft.textContent=`Referrals: ${ge.referralCount}/${ge.rewardThreshold} (OAuth signups)`,bs.textContent=e,bs.classList.remove("referral-hidden"),Ps.classList.remove("referral-hidden"),ge.rewardEligible&&!ge.rewardClaimed?Bn.classList.remove("referral-hidden"):Bn.classList.add("referral-hidden")}async function Qs(){if(!Vs){Xe=!1,Ut();return}try{Xe=!!(await(await fetch("/api/saved-match",{credentials:"include"})).json()).hasSavedMatch}catch{Xe=!1}Ut()}function Ut(){const e=document.getElementById("resume-match-btn"),t=document.getElementById("landing-play");!e||!t||(Xe&&ie==="solo"?(e.classList.remove("hidden"),t.textContent="Start new game"):(e.classList.add("hidden"),t.textContent="Play"))}async function dr(){try{const s=await(await fetch("/auth/me",{credentials:"include"})).json(),{displayName:o,signedIn:i,userId:r,shelterColor:c}=s,l=o??"";if(we=l||null,fe=i,Vs=r,nr=c,i&&c&&localStorage.setItem(Js,c),i&&l)xe.innerHTML=`
        <span class="auth-profile">${yt(l)}</span>
        <a href="/auth/signout" class="auth-link">Sign out</a>
      `,Pt.textContent=l,At.textContent=l.charAt(0).toUpperCase(),gs.innerHTML='<a href="/auth/signout" class="auth-link" style="font-size:12px">Sign out</a>',ps.innerHTML=`<a href="${kt("/auth/google")}" class="auth-link" style="display:inline-block">Sign in with Google</a>`,re&&(re.placeholder=l);else{const f=l?`${yt(l)}`:"Guest";xe.innerHTML=`
        <a href="${kt("/auth/google")}" class="auth-link">Sign in with Google</a>
        <span class="auth-guest">${f}</span>
      `,Pt.textContent=l||"Guest",At.textContent=l?l.charAt(0).toUpperCase():"?",gs.innerHTML="",ps.innerHTML=`
        <a href="${kt("/auth/google")}">Sign in with Google</a>
      `,re&&(re.placeholder=l||"Nickname")}re&&l&&(re.value=l)}catch{we=null,fe=!1,xe.innerHTML=`
      <a href="${kt("/auth/google")}" class="auth-link">Sign in with Google</a>
      <span class="auth-guest">Guest</span>
    `,Pt.textContent="Guest",At.textContent="?",gs.innerHTML="",ps.innerHTML=`<a href="${kt("/auth/google")}">Sign in with Google</a>`,re&&(re.placeholder="Nickname")}await Ti(),Bi(),await Yi(),await Qs(),new URLSearchParams(window.location.search).get("registered")==="1"&&fe&&setTimeout(()=>{se("Welcome! Registration gift: 50 RT + Day 1 gift claimed!","success"),window.history.replaceState({},"",window.location.pathname)},500)}async function Mi(){var t;const e=(t=re==null?void 0:re.value)==null?void 0:t.trim();if(!e||e.length<1){We&&(We.textContent="Enter a nickname first!");return}if(fe)try{const o=await(await fetch("/auth/profile",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({nickname:e})})).json();o.success&&(we=o.displayName,Pt.textContent=o.displayName,At.textContent=o.displayName.charAt(0).toUpperCase(),Ee&&(Ee.textContent="Saved!",Ee.classList.add("saved"),setTimeout(()=>{Ee.textContent="Save",Ee.classList.remove("saved")},2e3)),We&&(We.textContent=""))}catch{We&&(We.textContent="Failed to save")}else we=e,Pt.textContent=e,At.textContent=e.charAt(0).toUpperCase(),Ee&&(Ee.textContent="Saved!",Ee.classList.add("saved"),setTimeout(()=>{Ee.textContent="Save",Ee.classList.remove("saved")},2e3)),We&&(We.textContent="Sign in to save permanently")}Ee&&Ee.addEventListener("click",Mi);re&&re.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),Mi())});async function fr(){var s;const e=(s=re==null?void 0:re.value)==null?void 0:s.trim();if(e){if(fe&&e!==we)try{await fetch("/auth/profile",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({nickname:e})})}catch{}return we=e,e}if(we)return we;try{const i=await(await fetch("/auth/guest",{method:"POST",credentials:"include"})).json();if(i.displayName)return we=i.displayName,Pt.textContent=i.displayName,At.textContent=i.displayName.charAt(0).toUpperCase(),i.displayName}catch{}const t=`rescue${Date.now().toString(36)}`;return we=t,t}function yt(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function Pi(){const e=window.innerWidth,t=window.innerHeight;L.width=e,L.height=t}function O(e,t){t?ln|=e:ln&=~e}let Us=!1;function Yt(){const e=a==null?void 0:a.players.find(t=>t.id===P);return(e==null?void 0:e.eliminated)===!0}function ur(){const e=Yt();if(e&&!Us){const t=a==null?void 0:a.players.find(s=>s.id===P);t&&(_e=t.x,Ue=t.y)}Us=e}function hr(e){const t=e.target;if(!(t.tagName==="INPUT"||t.tagName==="TEXTAREA"||t.isContentEditable)){if(Z[e.code]=!0,p.active){e.preventDefault();return}if(Yt()){e.preventDefault();return}(e.code==="KeyW"||e.code==="ArrowUp")&&O(Oe,!0),(e.code==="KeyS"||e.code==="ArrowDown")&&O(De,!0),(e.code==="KeyA"||e.code==="ArrowLeft")&&O(Ne,!0),(e.code==="KeyD"||e.code==="ArrowRight")&&O($e,!0),e.preventDefault()}}function mr(e){if(Z[e.code]=!1,p.active){e.preventDefault();return}if(Yt()){e.preventDefault();return}(e.code==="KeyW"||e.code==="ArrowUp")&&O(Oe,!1),(e.code==="KeyS"||e.code==="ArrowDown")&&O(De,!1),(e.code==="KeyA"||e.code==="ArrowLeft")&&O(Ne,!1),(e.code==="KeyD"||e.code==="ArrowRight")&&O($e,!1),e.preventDefault()}function yr(){return!!(Z.KeyW||Z.KeyS||Z.KeyA||Z.KeyD||Z.ArrowUp||Z.ArrowDown||Z.ArrowLeft||Z.ArrowRight)}function gr(){if(yr())return;if(p.active){O(Ne,!1),O($e,!1),O(Oe,!1),O(De,!1);return}if(!Ft){O(Ne,!1),O($e,!1),O(Oe,!1),O(De,!1);return}const e=es-Dn,t=ts-_n,s=Math.hypot(e,t);if(s<fa){O(Ne,!1),O($e,!1),O(Oe,!1),O(De,!1);return}const o=e/s,i=t/s;O(Ne,o<-.3),O($e,o>.3),O(Oe,i<-.3),O(De,i>.3)}L.addEventListener("touchstart",e=>{e.preventDefault(),e.touches.length&&(Ft=!0,Dn=e.touches[0].clientX,_n=e.touches[0].clientY,es=Dn,ts=_n)},{passive:!1});L.addEventListener("touchmove",e=>{e.preventDefault(),e.touches.length&&Ft&&(es=e.touches[0].clientX,ts=e.touches[0].clientY)},{passive:!1});function Ai(){if((d==null?void 0:d.readyState)===WebSocket.OPEN){const e=ni(ln,fi++);d.send(e)}}L.addEventListener("touchend",e=>{e.preventDefault(),e.touches.length===0&&(Ft=!1,O(Ne,!1),O($e,!1),O(Oe,!1),O(De,!1),Ai())},{passive:!1});L.addEventListener("touchcancel",e=>{e.preventDefault(),Ft=!1,O(Ne,!1),O($e,!1),O(Oe,!1),O(De,!1),Ai()},{passive:!1});let eo=!1,Fs=0,Ys=0;L.addEventListener("mousedown",e=>{e.preventDefault(),Yt()&&(eo=!0,Fs=e.clientX,Ys=e.clientY)});L.addEventListener("mousemove",e=>{if(e.preventDefault(),Yt()&&eo){const t=e.clientX-Fs,s=e.clientY-Ys;_e-=t,Ue-=s,_e=Math.max(L.width/2,Math.min(V-L.width/2,_e)),Ue=Math.max(L.height/2,Math.min(ne-L.height/2,Ue)),Fs=e.clientX,Ys=e.clientY}});L.addEventListener("mouseup",e=>{e.preventDefault(),eo=!1});L.addEventListener("contextmenu",e=>{e.preventDefault()});function Ri(e,t){if(!a||!P||!d||d.readyState!==WebSocket.OPEN)return;const s=Ni(),o=e+s.x,i=t+s.y;for(const r of a.players){if(r.id===P||r.eliminated)continue;const c=ct+r.size*dt;if(o>=r.x-c&&o<=r.x+c&&i>=r.y-c&&i<=r.y+c){Hn.has(r.id)||(d.send(JSON.stringify({type:"allyRequest",targetId:r.id})),Hn.add(r.id));break}}}L.addEventListener("click",e=>{if(!a||!P||!d||d.readyState!==WebSocket.OPEN)return;const t=L.getBoundingClientRect(),s=L.width/t.width,o=L.height/t.height,i=(e.clientX-t.left)*s,r=(e.clientY-t.top)*o;Ri(i,r)});L.addEventListener("touchend",e=>{if(!a||!P||!d||d.readyState!==WebSocket.OPEN||e.changedTouches.length!==1)return;const t=e.changedTouches[0],s=L.getBoundingClientRect(),o=L.width/s.width,i=L.height/s.height,r=(t.clientX-s.left)*o,c=(t.clientY-s.top)*i;Ri(r,c)});window.addEventListener("keydown",hr);window.addEventListener("keyup",mr);let Ke=!1;function os(e,t){const s=Ce.getBoundingClientRect(),o=e-s.left,i=t-s.top,r=V/120,c=o*r,l=i*r,f=(x==null?void 0:x.x)??V/2,y=(x==null?void 0:x.y)??ne/2;gt=c-f,pt=l-y}Ce.addEventListener("mousedown",e=>{e.preventDefault(),Ke=!0,os(e.clientX,e.clientY)});Ce.addEventListener("mousemove",e=>{Ke&&os(e.clientX,e.clientY)});Ce.addEventListener("mouseup",()=>{Ke=!1});Ce.addEventListener("mouseleave",()=>{Ke=!1});Ce.addEventListener("touchstart",e=>{e.preventDefault(),Ke=!0,e.touches.length>0&&os(e.touches[0].clientX,e.touches[0].clientY)},{passive:!1});Ce.addEventListener("touchmove",e=>{Ke&&e.touches.length>0&&(e.preventDefault(),os(e.touches[0].clientX,e.touches[0].clientY))},{passive:!1});Ce.addEventListener("touchend",()=>{Ke=!1});Ce.addEventListener("touchcancel",()=>{Ke=!1});let Be=null,Me=null;const Uo=.22;let gt=0,pt=0,_e=V/2,Ue=ne/2;const In=15;let Ae=null,Re=null;const Fo=.2;function Ni(){const e=L.width,t=L.height,s=a==null?void 0:a.players.find(h=>h.id===P);if((s==null?void 0:s.eliminated)===!0){const h=Math.max(0,Math.min(V-e,_e-e/2)),k=Math.max(0,Math.min(ne-t,Ue-t/2));return{x:h,y:k,w:e,h:t}}let i=(x==null?void 0:x.x)??V/2,r=(x==null?void 0:x.y)??ne/2;(!Number.isFinite(i)||!Number.isFinite(r))&&(i=V/2,r=ne/2);let c=i-e/2+gt,l=r-t/2+pt;if(c=Math.max(0,Math.min(V-e,c)),l=Math.max(0,Math.min(ne-t,l)),x==null)return Be=null,Me=null,{x:c,y:l,w:e,h:t};Be==null||Me==null||!Number.isFinite(Be)||!Number.isFinite(Me)?(Be=c,Me=l):(Be+=(c-Be)*Uo,Me+=(l-Me)*Uo);let f=Be,y=Me;return(!Number.isFinite(f)||!Number.isFinite(y))&&(f=c,y=l,Be=f,Me=y),f=Math.max(0,Math.min(V-e,f)),y=Math.max(0,Math.min(ne-t,y)),{x:f,y,w:e,h:t}}const pr=30;function br(e,t,s){let o=0,i=0;t&Ne&&(o-=1),t&$e&&(o+=1),t&Oe&&(i-=1),t&De&&(i+=1);let r=0,c=0;if(o!==0||i!==0){const h=Math.hypot(o,i)||1,R=((e.speedBoostUntil??0)>0?fo*ji:fo)*s;r=o/h*R,c=i/h*R}const l=pr;let f=e.x+r,y=e.y+c;return f=Math.max(l,Math.min(V-l,f)),y=Math.max(l,Math.min(ne-l,y)),{...e,x:f,y,vx:r,vy:c,petsInside:[...e.petsInside],speedBoostUntil:e.speedBoostUntil??0}}const Yo=1e4;function to(e){oe.classList.remove("hidden"),oe.innerHTML=`
    <h2>Could not connect</h2>
    <p class="error">${e}</p>
    <p>The game server is not running or not reachable.</p>
    <p><strong>To start the game:</strong></p>
    <p>From the project root folder, run: <code>npm run dev</code></p>
    <p>That starts both the server (ports 4000, 4001) and the client. Wait a few seconds, then refresh this page.</p>
    <p>Or run in two terminals: first <code>npm run dev:server</code>, then <code>npm run dev:client</code>.</p>
  `}async function no(e){pn&&(clearInterval(pn),pn=null),Sa.classList.add("hidden");const t=c=>/^wss?:\/\/localhost(\b|:|\/|$)/i.test(c)||/^wss?:\/\/127\.0\.0\.1(\b|:|\/|$)/i.test(c),s=()=>{const{protocol:c,host:l}=window.location;return`${c==="https:"?"wss:":"ws:"}//${l}/ws-game`};let o=t(window.location.href)?"ws://localhost:4001":s();const i=new WebSocket(da);await new Promise((c,l)=>{const f=setTimeout(()=>{i.close(),l(new Error("Connection timeout. Is the server running? Run: npm run dev"))},Yo);i.onopen=()=>{i.send(JSON.stringify({type:"join",latency:e==null?void 0:e.latency,mode:(e==null?void 0:e.mode)??"ffa"}))},i.onmessage=y=>{try{const h=JSON.parse(y.data);h.type==="joined"&&h.gameUrl&&(clearTimeout(f),o=h.gameUrl,!t(window.location.href)&&t(o)&&(o=s()),c())}catch{}},i.onerror=()=>{clearTimeout(f),l(new Error("WebSocket error. Server not running?"))},i.onclose=()=>{clearTimeout(f),i.readyState!==WebSocket.OPEN&&l(new Error("Signaling connection closed. Run: npm run dev"))}});const r=new WebSocket(o);r.binaryType="arraybuffer",r.onopen=async()=>{d=r;const c=await fr(),l=await Jr(),f=l.rt,y=l.ports;f>0&&se(`Starting with ${f} RT from chest!`,"success"),d.send(JSON.stringify({type:"mode",mode:(e==null?void 0:e.mode)??"ffa",displayName:c,startingRT:f,startingPorts:y,userId:Vs})),(ue.sizeBonus>0||ue.speedBoost||ue.adoptSpeed)&&(d.send(JSON.stringify({type:"startingBoosts",sizeBonus:ue.sizeBonus,speedBoost:ue.speedBoost,adoptSpeed:ue.adoptSpeed})),ue.sizeBonus=0,ue.speedBoost=!1,ue.adoptSpeed=!1);const h=Si();d.send(JSON.stringify({type:"setColor",color:h})),(e==null?void 0:e.mode)==="solo"&&Xo&&d.send(JSON.stringify({type:"setCpuBreederBehavior",canShutdown:Xo.checked}))},r.onmessage=c=>{var f,y,h,k,R;if(typeof c.data=="string"){try{const u=JSON.parse(c.data);if(u.type==="welcome"&&u.playerId&&(P=u.playerId,aa()),u.type==="savedMatchExpired"){Xe=!1,Ut(),Qs();const v=typeof u.reason=="string"?u.reason:"Match already ended";se(v,"info"),d&&(d.close(),d=null),oe==null||oe.classList.add("hidden")}if(u.type==="matchState"&&typeof u.phase=="string"&&(K=u.phase,Ss=typeof u.countdownRemainingSec=="number"?u.countdownRemainingSec:0,tr=typeof u.readyCount=="number"?u.readyCount:0,Array.isArray(u.players)&&u.players.length>0?vs.innerHTML=u.players.map(v=>`<div class="lobby-player">${yt(v.displayName)}</div>`).join(""):vs.innerHTML="",K==="lobby"?ie==="solo"?xt.classList.add("hidden"):(xt.classList.remove("hidden"),Rs.textContent="Waiting for another player‚Ä¶",Es.classList.add("hidden"),Lt.classList.add("hidden")):K==="countdown"?(xt.classList.remove("hidden"),Rs.textContent="Match starting soon",Es.classList.remove("hidden"),Es.textContent=Ss>0?`Starting in ${Ss}s‚Ä¶`:"Starting‚Ä¶",Lt.classList.remove("hidden"),qn?Lt.textContent="Ready!":Lt.textContent="Ready"):(xt.classList.add("hidden"),vs.innerHTML="")),u.type==="pong"&&typeof u.ts=="number"&&(Ts=Math.round(Date.now()-u.ts),Ts>ha?ms=ms||Date.now():ms=0),u.type==="groundFailed"&&typeof u.reason=="string"&&se(u.reason),u.type==="breederStart"&&typeof u.petCount=="number"){const v=typeof u.level=="number"?u.level:1,b=!!u.isMill,B=typeof u.timeLimitSeconds=="number"?u.timeLimitSeconds:void 0,m=typeof u.addPetIntervalSeconds=="number"?u.addPetIntervalSeconds:void 0;Rr(u.petCount,v,{isMill:b,timeLimitSeconds:B,addPetIntervalSeconds:m})}if(u.type==="breederAddPet"&&p.active){const v=["dog","cat","horse","bird","rabbit"],b=v[Math.floor(Math.random()*v.length)];p.pets.push({type:b,rescued:!1}),p.totalPets++,fn(),lt()}if(u.type==="breederRewards"){const v=typeof u.tokenBonus=="number"?u.tokenBonus:0,b=Array.isArray(u.rewards)?u.rewards:[];Dr(v,b)}u.type==="announcement"&&Array.isArray(u.messages)&&sr(u.messages),u.type==="allyRequestReceived"&&typeof u.fromId=="string"&&typeof u.fromName=="string"&&ir(u.fromId,u.fromName),u.type==="transferResult"&&(Zs(),u.success&&typeof u.count=="number"?se(`Transferred ${u.count} pets! You +${u.senderScore??0} score, ally +${u.receiverScore??0}`):typeof u.reason=="string"&&se(u.reason))}catch{}return}const l=c.data;if(!(l.byteLength<1)&&new DataView(l).getUint8(0)===ti){const u=Qi(l);a=u,K!=="playing"&&(K="playing",xt.classList.add("hidden"));for(const b of u.players){const B=((f=Un.get(b.id))==null?void 0:f.next)??b;Un.set(b.id,{prev:B,next:{...b},t:0});const m=To.get(b.id);if(m){const A=b.x-m.x,D=b.y-m.y;Math.hypot(A,D)>200&&!dn.has(b.id)&&dn.set(b.id,{startTime:Date.now(),fromX:m.x,fromY:m.y,toX:b.x,toY:b.y,phase:"fadeIn"})}To.set(b.id,{x:b.x,y:b.y})}for(const b of u.pets){const B=((y=Fn.get(b.id))==null?void 0:y.next)??b;Fn.set(b.id,{prev:B,next:{...b},t:0})}const v=u.players.find(b=>b.id===P);if(v){const b=!!v.shelterId;if(v.size>fs&&!b&&v.size<50?(ui=Date.now()+1500,$n()):v.size>fs&&$n(),(v.speedBoostUntil??0)>bo&&na(),bo=v.speedBoostUntil??0,v.totalAdoptions>us){sa();const M=v.totalAdoptions-us,H=(h=a==null?void 0:a.shelters)==null?void 0:h.find(N=>N.ownerId===P);let j;if(H!=null&&H.hasAdoptionCenter){j=po.filter(U=>!H.petsInside.includes(U)).slice(0,M);const N=j.map(U=>hs.get(U)??Le);Mo(H.x,H.y,H.x,H.y-100,N)}else{j=go.filter(Y=>!v.petsInside.includes(Y)).slice(0,M);const N=j.map(Y=>hs.get(Y)??Le),U=(k=a==null?void 0:a.adoptionZones)==null?void 0:k[0];U&&Mo(v.x,v.y,U.x,U.y,N)}}us=v.totalAdoptions,v.petsInside.length>yo&&oa(),yo=v.petsInside.length,go=[...v.petsInside];const B=(R=a==null?void 0:a.shelters)==null?void 0:R.find(M=>M.ownerId===P);po=B?[...B.petsInside]:[];for(const M of u.pets)hs.set(M.id,M.petType??Le);fs=v.size;const m=(x==null?void 0:x.x)??v.x,A=(x==null?void 0:x.y)??v.y;x={...v,petsInside:[...v.petsInside]},v.inputSeq,Math.hypot(v.x-m,v.y-A)>300&&(Be=null,Me=null,gt=0,pt=0,Ae=v.x,Re=v.y)}}},r.onclose=()=>{d=null,P=null,a=null,x=null,K="playing",Hn.clear(),qn=!1},await new Promise((c,l)=>{const f=Date.now()+Yo,y=()=>{(d==null?void 0:d.readyState)===WebSocket.OPEN?c():Date.now()>f?l(new Error("Game server connection timeout")):setTimeout(y,50)};y()}),oe.classList.add("hidden"),ba.classList.add("hidden"),un(),pn=setInterval(()=>{(d==null?void 0:d.readyState)===WebSocket.OPEN&&d.send(JSON.stringify({type:"ping",ts:Date.now()}))},2e3)}let xn=0,zo=0;function so(e){var l,f;xn||(xn=e);const t=Math.min((e-xn)/1e3,.1);xn=e,gr(),ur(),Yt()&&((Z.KeyW||Z.ArrowUp)&&(Ue-=In),(Z.KeyS||Z.ArrowDown)&&(Ue+=In),(Z.KeyA||Z.ArrowLeft)&&(_e-=In),(Z.KeyD||Z.ArrowRight)&&(_e+=In),_e=Math.max(L.width/2,Math.min(V-L.width/2,_e)),Ue=Math.max(L.height/2,Math.min(ne-L.height/2,Ue)));const s=a!=null&&a.matchEndAt>0&&a.tick>=a.matchEndAt,o=a==null?void 0:a.players.find(y=>y.id===P),r=K==="playing"&&!s&&!(o!=null&&o.eliminated)&&!p.active;if(r&&(d==null?void 0:d.readyState)===WebSocket.OPEN&&e-zo>=Ki){zo=e;const y=ni(ln,fi++);d.send(y)}if(r&&x&&P){x.x,x.y,x=br(x,ln,t);let y=x.x,h=x.y;(!Number.isFinite(y)||!Number.isFinite(h))&&(y=V/2,h=ne/2),Ae==null||Re==null?(Ae=y,Re=h):(Ae+=(y-Ae)*Fo,Re+=(h-Re)*Fo),(!Number.isFinite(Ae)||!Number.isFinite(Re))&&(Ae=y,Re=h);let k=null,R=!1;if(a){const u=a.players.find(b=>b.id===P),v=u!=null&&u.shelterId?(l=a.shelters)==null?void 0:l.find(b=>b.id===u.shelterId):null;if(v){const b=ct+v.size*dt;for(const B of a.players){if(B.id===P)continue;const m=B.shelterId?(f=a.shelters)==null?void 0:f.find(M=>M.id===B.shelterId):null;if(!m)continue;const A=ct+m.size*dt;if(Math.abs(v.x-m.x)<=b+A&&Math.abs(v.y-m.y)<=b+A&&!(v.size<uo||m.size<uo)){if(B.id.startsWith("cpu-")){R=!0;continue}if(!$s.has(B.id)){k=B.id;break}}}}}if(k){const u=a.players.find(b=>b.id===k);at=k,Ca.textContent=(u==null?void 0:u.displayName)??k;const v=Vt.classList.contains("hidden");Vt.classList.remove("hidden"),v&&Date.now()-Sn>Lo&&(Sn=Date.now(),On())}else Vt.classList.add("hidden"),at=null,$s.clear();if(R){const u=bn.classList.contains("hidden");bn.classList.remove("hidden"),u&&Date.now()-Sn>Lo&&(Sn=Date.now(),On())}else bn.classList.add("hidden")}else Ae=null,Re=null,Vt.classList.add("hidden"),at=null,bn.classList.add("hidden");const c=t*(1e3/ua);for(const y of Un.values())y.t=Math.min(1,y.t+c);for(const y of Fn.values())y.t=Math.min(1,y.t+c);Mr(),requestAnimationFrame(so)}function Tt(e,t,s){return e+(t-e)*s}function vr(e){const t=Un.get(e);if(!t)return null;const s=t.t;return{...t.next,x:Tt(t.prev.x,t.next.x,s),y:Tt(t.prev.y,t.next.y,s),vx:Tt(t.prev.vx,t.next.vx,s),vy:Tt(t.prev.vy,t.next.vy,s)}}function Er(e){const t=Fn.get(e);if(!t)return null;const s=t.t;return{...t.next,x:Tt(t.prev.x,t.next.x,s),y:Tt(t.prev.y,t.next.y,s)}}const me=36,kn=1.8;function oo(e){let t=0;for(let o=0;o<e.length;o++)t=t*31+e.charCodeAt(o)>>>0;return`hsl(${t%360}, 72%, 58%)`}function wr(e){const t=me*2,s=Math.floor((e.x-t)/me)*me,o=Math.floor((e.y-t)/me)*me,i=Math.ceil((e.x+e.w+t)/me)*me,r=Math.ceil((e.y+e.h+t)/me)*me;n.fillStyle="#3d6b3d",n.fillRect(e.x,e.y,e.w,e.h),n.fillStyle="rgba(255,255,255,0.35)";for(let c=o;c<=r;c+=me)for(let l=s;l<=i;l+=me)n.fillRect(l-kn,c-kn,kn*2,kn*2)}function Sr(e){const t=e.x,s=e.y,o=e.radius||Tn;!Number.isFinite(t)||!Number.isFinite(s)||!Number.isFinite(o)||(n.save(),n.strokeStyle="rgba(123, 237, 159, 0.6)",n.lineWidth=4,n.setLineDash([8,8]),n.strokeRect(t-o,s-o,o*2,o*2),n.setLineDash([]),n.fillStyle="rgba(74, 124, 89, 0.2)",n.fillRect(t-o,s-o,o*2,o*2),n.fillStyle="#7bed9f",n.font="bold 14px Rubik, sans-serif",n.textAlign="center",n.fillText("ADOPTION CENTER",t,s-o-8),n.fillText("Bring pets here to adopt out",t,s),n.restore())}const $i=350;function Ir(e,t){const s=e.x,o=e.y,i=$i,r=Math.max(0,e.startTick+e.durationTicks-t),c=Math.ceil(r/25),l=80;n.save(),di?n.drawImage(He,s-l/2,o-l/2,l,l):(n.fillStyle="rgba(255, 193, 7, 0.4)",n.beginPath(),n.arc(s,o,l/2,0,Math.PI*2),n.fill(),n.strokeStyle="#ffc107",n.lineWidth=2,n.stroke()),n.strokeStyle="rgba(255, 193, 7, 0.8)",n.lineWidth=4,n.setLineDash([12,8]),n.beginPath(),n.arc(s,o,i,0,Math.PI*2),n.stroke(),n.setLineDash([]),n.fillStyle="rgba(255, 193, 7, 0.12)",n.beginPath(),n.arc(s,o,i,0,Math.PI*2),n.fill(),n.fillStyle="#ffc107",n.font="bold 14px Rubik, sans-serif",n.textAlign="center";const f=e.type.replace(/_/g," ").replace(/\b\w/g,y=>y.toUpperCase());n.fillText(`üì¢ ${f}`,s,o-i-10),n.font="12px Rubik, sans-serif",n.fillText(`${c}s left - bring pets here!`,s,o+l/2+14),n.restore()}function Wo(e,t,s,o){n.save();const i=60,r=o?s:1-s,c=o?.5+s*.5:1+s*.5;n.translate(e,t),n.scale(c,c),n.beginPath(),n.arc(0,0,i,0,Math.PI*2),n.strokeStyle=`rgba(200, 150, 255, ${r*.8})`,n.lineWidth=4,n.stroke();const l=n.createRadialGradient(0,0,0,0,0,i);l.addColorStop(0,`rgba(180, 120, 255, ${r*.6})`),l.addColorStop(.5,`rgba(140, 80, 220, ${r*.3})`),l.addColorStop(1,"rgba(100, 50, 180, 0)"),n.fillStyle=l,n.beginPath(),n.arc(0,0,i,0,Math.PI*2),n.fill();const f=8,y=Date.now()/100;for(let h=0;h<f;h++){const k=h/f*Math.PI*2+y*.5,R=i*.6*(.8+Math.sin(y+h)*.2),u=Math.cos(k)*R,v=Math.sin(k)*R,b=3+Math.sin(y*2+h)*1.5;n.beginPath(),n.arc(u,v,b,0,Math.PI*2),n.fillStyle=`rgba(255, 255, 255, ${r*.9})`,n.fill()}n.restore()}function Ho(e,t,s,o,i="large"){n.save();const r=i==="small"?.5:1,c=i==="small"?.6:1,l=e-o*(s+8*r),f=t,y=Date.now()/100,h=Math.sin(y*3)*.3+.7,k=Math.cos(y*4)*.2+.8,R=25*r,u=n.createRadialGradient(l,f,0,l,f,R);u.addColorStop(0,`rgba(255, 200, 50, ${.6*h*c})`),u.addColorStop(.5,`rgba(255, 100, 20, ${.4*h*c})`),u.addColorStop(1,"rgba(255, 50, 0, 0)"),n.fillStyle=u,n.beginPath(),n.arc(l,f,R,0,Math.PI*2),n.fill();const v=18*r,b=10*r,B=v+Math.sin(y*5)*4*r,m=b+Math.cos(y*6)*2*r;n.beginPath(),n.moveTo(l+o*5,f-m/2),n.quadraticCurveTo(l-o*B*.6,f-m*.3*k,l-o*B,f),n.quadraticCurveTo(l-o*B*.6,f+m*.3*k,l+o*5,f+m/2),n.closePath();const A=n.createLinearGradient(l+o*5,f,l-o*B,f);A.addColorStop(0,"#FFD700"),A.addColorStop(.3,"#FF8C00"),A.addColorStop(.7,"#FF4500"),A.addColorStop(1,"rgba(255, 69, 0, 0.3)"),n.fillStyle=A,n.fill();const D=B*.6,M=m*.5;n.beginPath(),n.moveTo(l+o*5,f-M/2),n.quadraticCurveTo(l-o*D*.5,f-M*.2,l-o*D,f),n.quadraticCurveTo(l-o*D*.5,f+M*.2,l+o*5,f+M/2),n.closePath(),n.fillStyle="#FFFF80",n.fill(),n.restore()}function xr(e,t){const i=e.x,r=e.y,c=dn.get(e.id);let l=1;if(c){const z=Date.now()-c.startTime;c.phase==="fadeIn"&&(l=Math.min(1,z/Os),z>=Os&&(dn.delete(e.id),l=1))}Math.abs(e.vx)>.01&&Co.set(e.id,e.vx>0?1:-1);const f=Co.get(e.id)??1;n.save(),n.globalAlpha=l,n.shadowColor="rgba(0,0,0,0.4)",n.shadowBlur=10;const y=(a==null?void 0:a.tick)??0,h=(e.speedBoostUntil??0)>y,k=!!e.vanSpeedUpgrade;e.eliminated||(h?Ho(i,r,50,f,"large"):k&&Ho(i,r,50,f,"small"));let R,u=t?"#7bed9f":oo(e.id);if(e.eliminated)R="rgba(100,100,100,0.5)",u="#666";else if(e.shelterColor)if(e.shelterColor.startsWith("gradient:")){const z=e.shelterColor.split(":"),le=z[1]||"#ff5500",he=z[2]||"#00aaff",pe=n.createLinearGradient(i-50,r-50*.6,i+50,r+50*.6);pe.addColorStop(0,le),pe.addColorStop(1,he),R=pe,u=le}else R=e.shelterColor,u=e.shelterColor;else R=u;const v=50*2,b=50*1.2,B=i-50,m=r-b*.5,A=Math.min(12,50*.3),D=Math.min(10,50*.25);n.translate(i,r),f<0&&n.scale(-1,1),n.fillStyle=R,n.beginPath(),n.roundRect(-50,-b*.5,v,b,A),n.fill();const M=v*.3;n.fillStyle="rgba(0,0,0,0.15)",n.beginPath(),n.roundRect(-50+v-M,-b*.5,M,b,[0,A,A,0]),n.fill();const H=4,j=M-H*2,N=b*.4;n.fillStyle="rgba(135,206,250,0.7)",n.beginPath(),n.roundRect(-50+v-M+H,-b*.5+H,j,N,4),n.fill();const U=!t&&Hn.has(e.id);U?(n.strokeStyle="#7bed9f",n.lineWidth=3,n.setLineDash([6,4])):(n.strokeStyle=t?"rgba(255,255,255,0.9)":"rgba(255,255,255,0.5)",n.lineWidth=t?3:2),n.beginPath(),n.roundRect(-50,-b*.5,v,b,A),n.stroke(),n.setLineDash([]),f<0&&n.scale(-1,1),n.translate(-i,-r),n.fillStyle="#333";const Y=m+b+D*.3,q=B+v*.2,F=B+v*.7;n.beginPath(),n.arc(q,Y,D,0,Math.PI*2),n.fill(),n.beginPath(),n.arc(F,Y,D,0,Math.PI*2),n.fill(),n.fillStyle="#888",n.beginPath(),n.arc(q,Y,D*.4,0,Math.PI*2),n.fill(),n.beginPath(),n.arc(F,Y,D*.4,0,Math.PI*2),n.fill(),n.fillStyle="#2d2d2d",n.font="bold 12px Rubik, sans-serif",n.textAlign="center";const X=t?"You":e.displayName??e.id;n.fillText(X,i,m-6),U&&(n.fillStyle="#7bed9f",n.fillText("ü§ù",i+50+10,m+10),n.fillStyle="#2d2d2d"),e.eliminated&&(n.font="18px sans-serif",n.fillText("üëª",i-50*.3,r),n.font="bold 12px Rubik, sans-serif");const G=Math.min(Math.floor(e.size),Vo);n.fillStyle="#fff",n.fillText(`Pets: ${e.petsInside.length}/${G}`,i,r+4),n.restore()}function kr(e,t,s){const o=e.x,i=e.y,r=ct+e.size*dt,c=Math.min(400,Math.max(40,r));n.save(),n.shadowColor="rgba(0,0,0,0.4)",n.shadowBlur=12;let l;if(s!=null&&s.startsWith("gradient:")){const F=s.split(":"),X=F[1]||"#7bed9f",G=F[2]||"#3cb371",z=n.createLinearGradient(o-c,i,o+c,i);z.addColorStop(0,X),z.addColorStop(1,G),l=z}else s?l=s:l=t?"#7bed9f":oo(e.ownerId);n.fillStyle=l;const f=c*2,y=c*1.4,h=o-c,k=i-y*.4;n.beginPath(),n.roundRect(h,k,f,y,6),n.fill(),n.fillStyle="#8B4513",n.beginPath(),n.moveTo(h-10,k),n.lineTo(o,k-c*.5),n.lineTo(h+f+10,k),n.closePath(),n.fill(),n.strokeStyle="#654321",n.lineWidth=2,n.stroke();const R=f*.2,u=y*.5;n.fillStyle="#654321",n.fillRect(o-R/2,k+y-u,R,u);const v=12,b=4,B=Math.floor((f-40)/(v+b)),m=Math.min(e.petsInside.length+2,B*2);for(let F=0;F<m;F++){const X=Math.floor(F/B),G=F%B,z=h+20+G*(v+b),le=k+15+X*(v+b),he=F<e.petsInside.length;n.fillStyle=he?"#c9a86c":"#aaa",n.fillRect(z,le,v,v),n.strokeStyle="#666",n.lineWidth=1,n.strokeRect(z,le,v,v)}n.setLineDash([5,5]),n.strokeStyle=t?"#7bed9f":"rgba(255,255,255,0.5)",n.lineWidth=2;const A=15;n.strokeRect(h-A,k-c*.5-A,f+A*2,y+c*.5+A*2),n.setLineDash([]);const D=k-c*.5-25;let M=o-30;n.font="14px sans-serif",n.textAlign="center",e.hasAdoptionCenter&&(n.fillText("üêæ",M,D),M+=20),e.hasGravity&&(n.fillText("üß≤",M,D),M+=20),e.hasAdvertising&&(n.fillText("üì¢",M,D),M+=20),n.fillStyle="#333",n.font="bold 11px Rubik, sans-serif",n.textAlign="center";const H=t?"Your Shelter":"Shelter";n.fillText(H,o,k-c*.5-8);const j=e.tier??1,U=["#888","#7bed9f","#70a3ff","#c77dff","#ffd700"][Math.min(j-1,4)],Y=o+c*.8,q=k-c*.3;n.fillStyle=U,n.beginPath(),n.arc(Y,q,14,0,Math.PI*2),n.fill(),n.strokeStyle="#fff",n.lineWidth=2,n.stroke(),n.fillStyle=j>=5?"#333":"#fff",n.font="bold 12px Rubik, sans-serif",n.textBaseline="middle",j>=5?n.fillText("‚òÖ"+j,Y,q):n.fillText(String(j),Y,q),n.textBaseline="alphabetic",n.fillStyle="#fff",n.font="10px Rubik, sans-serif",n.fillText(`Pets: ${e.petsInside.length}`,o,k+y+12),n.fillStyle="#7bed9f",n.fillText(`Adoptions: ${e.totalAdoptions}`,o,k+y+24),n.restore()}function Lr(e){const t=e.x,s=e.y,o=80+e.size*.8;n.save();const i=.5+.5*Math.sin(Date.now()/200);if(n.shadowColor=`rgba(255, 0, 0, ${.4+i*.3})`,n.shadowBlur=20+i*10,ci){const r=o*1.5,c=o*1.2;n.drawImage(Jt,t-r/2,s-c/2,r,c)}else n.fillStyle="#4a1a1a",n.beginPath(),n.roundRect(t-o/2,s-o/2.5,o,o*.8,6),n.fill(),n.strokeStyle=`rgba(255, 68, 68, ${.6+i*.4})`,n.lineWidth=3,n.stroke();n.shadowBlur=0,n.fillStyle="#ff4444",n.font="bold 12px Rubik, sans-serif",n.textAlign="center",n.textBaseline="bottom",n.fillText(`Breeder Mill Lv${e.level}`,t,s-o/2-5),n.fillStyle="#ffaa00",n.font="10px Rubik, sans-serif",n.textBaseline="top",n.fillText("Spawning wild strays!",t,s+o/2.5+5),n.restore()}const qo={[Le]:"üêà",[Hs]:"üêï",[qs]:"üê¶",[Xs]:"üê∞",[Qn]:"‚≠ê"};function Cr(e,t,s=Le){n.save(),n.globalAlpha=1;const o=qo[s]??qo[Le];n.font="30px sans-serif",n.textAlign="center",n.textBaseline="middle",n.shadowColor="rgba(0,0,0,0.8)",n.shadowBlur=4,n.fillText(o,e,t),s===Qn&&(n.shadowColor="#ffd700",n.shadowBlur=12,n.fillText(o,e,t)),n.shadowBlur=0,n.restore()}function Tr(e,t,s=1){n.save(),n.translate(e,t),n.beginPath(),n.arc(0,0,31,0,Math.PI*2),n.fillStyle="#5a4a3a",n.fill(),n.fillStyle="#8B4513",n.strokeStyle="#5a3810",n.lineWidth=1;for(let A=0;A<10;A++){const D=A/10*Math.PI*2,M=Math.cos(D)*14,H=Math.sin(D)*14;n.fillRect(M-3/2,H-8/2,3,8)}n.beginPath(),n.arc(0,0,14,0,Math.PI*2),n.strokeStyle="#6d4c35",n.lineWidth=2,n.stroke();const f=(e*7+t*31+s*101|0)>>>0,y=["#ff9f43","#a17851","#74b9ff","#dfe6e9"],h=2+f%3;for(let A=0;A<h;A++){const D=f+A*17>>>0,M=(D%17-8)*.9,H=((D>>4)%17-8)*.9;n.beginPath(),n.arc(M,H,4,0,Math.PI*2),n.fillStyle=y[(D>>8)%y.length],n.fill(),n.strokeStyle="#333",n.lineWidth=.8,n.stroke()}n.beginPath(),n.moveTo(-20,12),n.lineTo(0,-18),n.lineTo(20,12),n.closePath(),n.fillStyle="#D2B48C",n.fill(),n.strokeStyle="#8B7355",n.lineWidth=1.5,n.stroke(),n.beginPath(),n.moveTo(-7,12),n.lineTo(0,4),n.lineTo(7,12),n.fillStyle="#4a3a2a",n.fill(),n.restore();const k=e+35-10,R=t-35+5;n.fillStyle="#fff",n.beginPath(),n.roundRect(k-10,R-8,20,16,3),n.fill(),n.strokeStyle="#333",n.lineWidth=1,n.stroke(),n.fillStyle="#000",n.font="bold 11px sans-serif",n.textAlign="center",n.textBaseline="middle",n.fillText(`${s}`,k,R);const u=3+Math.min(2,Math.floor(s/2)),v=Math.min(u+Math.floor(s/2),8);let b=1,B=8;s>=10?(b=4,B=13):s>=6?(b=3,B=11):s>=3&&(b=2);const m=v*b*B;n.font="bold 10px Rubik, sans-serif",n.fillStyle="#ff6b6b",n.textAlign="center",n.textBaseline="alphabetic",n.fillText(`Lv${s} ~${m}RT`,e,t+35+12)}function Br(e){const t=ho;if(n.save(),e.type===Qo){Tr(e.x,e.y,e.level??1),n.restore();return}let s="#7bed9f",o="#2d5a38",i="+Size";e.type===Vi?(s="#70a3ff",o="#2d4a6e",i="Speed"):e.type===Zo?(s="#c77dff",o="#6a3d7a",i="Random"):e.type===ei&&(s="#10b981",o="#047857",i="Home"),n.fillStyle=s,n.fillRect(e.x-t,e.y-t,t*2,t*2),n.strokeStyle=o,n.lineWidth=2,n.strokeRect(e.x-t,e.y-t,t*2,t*2),n.fillStyle="#333",n.font="10px Rubik, sans-serif",n.textAlign="center",n.fillText(i,e.x,e.y+ho+10),n.restore()}function Mr(e){var t,s,o;try{const i=Ni(),r=Number.isFinite(i.x)?Math.max(0,Math.min(V-i.w,i.x)):0,c=Number.isFinite(i.y)?Math.max(0,Math.min(ne-i.h,i.y)):0,l={x:r,y:c,w:i.w,h:i.h};if(n.save(),n.translate(-l.x,-l.y),wr(l),a){const S=a.adoptionZones.length>0?a.adoptionZones:[{id:"adopt-fallback",x:V/2,y:ne/2,radius:Tn}];for(const E of S)Sr(E);for(const E of a.adoptionEvents??[])Ir(E,a.tick);for(const E of a.pickups??[])Br(E);for(const E of a.shelters??[]){const g=E.ownerId===P,I=a.players.find($=>$.id===E.ownerId),T=I==null?void 0:I.shelterColor;kr(E,g,T)}for(const E of a.breederShelters??[])Lr(E)}for(const S of(a==null?void 0:a.pets)??[]){if(S.insideShelterId!==null)continue;const E=Er(S.id)??S;!Number.isFinite(E.x)||!Number.isFinite(E.y)||E.x===0&&E.y===0||Cr(E.x,E.y,S.petType??Le)}const f=[...(a==null?void 0:a.players)??[]].sort((S,E)=>S.size-E.size);for(const S of f){const E=S.id===P;let g;if(E&&x){let I=Ae??x.x,T=Re??x.y;(!Number.isFinite(I)||!Number.isFinite(T))&&(I=x.x,T=x.y),(!Number.isFinite(I)||!Number.isFinite(T))&&(I=V/2,T=ne/2),g={...x,x:I,y:T}}else g=vr(S.id)??S;if(!(!Number.isFinite(g.x)||!Number.isFinite(g.y))&&(xr(g,E),E&&ui>Date.now())){n.save(),n.setTransform(1,0,0,1,0,0);const I=L.width/2,T=L.height/2-60;n.fillStyle="#7bed9f",n.font="bold 28px Rubik, sans-serif",n.textAlign="center",n.fillText("+1 Size!",I,T),n.restore()}}const y=Date.now();for(let S=An.length-1;S>=0;S--){const E=An[S],g=y-E.startTime;if(g<0)continue;if(g>Bo){An.splice(S,1);continue}const I=g/Bo,T=1-Math.pow(1-I,3),$=E.fromX+(E.toX-E.fromX)*T,C=E.fromY+(E.toY-E.fromY)*T-Math.sin(I*Math.PI)*50,Q=I<.8?1:1-(I-.8)/.2;n.save(),n.globalAlpha=Q,n.font="bold 32px sans-serif",n.textAlign="center",n.textBaseline="middle",n.fillText(Qa[E.petType]??"üêæ",$,C),n.restore()}for(const[S,E]of dn){const g=Date.now()-E.startTime,I=Math.min(1,g/Os);E.phase==="fadeIn"&&(Wo(E.toX,E.toY,I,!0),I<.5&&Wo(E.fromX,E.fromY,I*2,!1))}n.restore();const h=120/V;w.fillStyle="#2d4a2d",w.fillRect(0,0,120,120);for(let S=0;S<=ne;S+=me*3)for(let E=0;E<=V;E+=me*3)w.fillStyle="rgba(255,255,255,0.15)",w.fillRect(E*h-.8,S*h-.8,1.6,1.6);if(a){const S=a.adoptionZones.length>0?a.adoptionZones:[{id:"adopt-fallback",x:V/2,y:ne/2,radius:Tn}];for(const g of S){const I=g.radius||Tn,T=Math.max(3,I*h|0);w.fillStyle="rgba(123, 237, 159, 0.6)",w.fillRect(g.x*h-T,g.y*h-T,T*2,T*2)}for(const g of a.pets)g.insideShelterId===null&&(g.x===0&&g.y===0||(w.fillStyle="#c9a86c",w.fillRect(g.x*h-2,g.y*h-2,4,4)));for(const g of a.pickups??[]){const I=g.x*h,T=g.y*h;if(g.type===Qo){const $=.5+.5*Math.sin(Date.now()/200),C=8+$*4;w.save(),w.shadowColor="#ff4444",w.shadowBlur=C,w.fillStyle="#8B4513",w.beginPath(),w.arc(I,T,4,0,Math.PI*2),w.fill(),w.strokeStyle=`rgba(255, 68, 68, ${.7+$*.3})`,w.lineWidth=2,w.stroke(),w.restore()}else w.fillStyle=g.type===Ji?"#7bed9f":g.type===Zo?"#c77dff":g.type===ei?"#10b981":"#70a3ff",w.fillRect(I-2,T-2,4,4)}for(const g of a.shelters??[]){const I=g.ownerId===P;w.fillStyle=I?"#e8d5b7":"#d4c4a8";const T=Math.min(g.size,2e3),$=(ct+T*dt)*h,C=Math.min(60,Math.max(4,$));if(w.fillRect(g.x*h-C,g.y*h-C,C*2,C*2),w.strokeStyle=I?"#7bed9f":"#8B4513",w.lineWidth=1,w.strokeRect(g.x*h-C,g.y*h-C,C*2,C*2),I){const Q=g.x*h,J=g.y*h;w.fillStyle="#7bed9f",w.beginPath(),w.moveTo(Q,J-C-4),w.lineTo(Q-5,J-C+1),w.lineTo(Q+5,J-C+1),w.closePath(),w.fill(),w.fillRect(Q-3,J-C+1,6,5)}}for(const g of a.breederShelters??[]){const I=g.x*h,T=g.y*h,$=Math.max(10,(40+g.size*.5)*h),C=.5+.5*Math.sin(Date.now()/200);w.save(),w.shadowColor="#ff0000",w.shadowBlur=8+C*8,w.fillStyle="#cc2222",w.fillRect(I-$,T-$,$*2,$*2),w.strokeStyle=`rgba(255, 50, 50, ${.9+C*.1})`,w.lineWidth=2.5,w.strokeRect(I-$,T-$,$*2,$*2),w.restore()}for(const g of a.adoptionEvents??[]){const I=g.x*h,T=g.y*h,$=Math.min(12,$i*h);w.strokeStyle="#5eead4",w.lineWidth=2,w.setLineDash([4,4]),w.beginPath(),w.arc(I,T,$,0,Math.PI*2),w.stroke(),w.setLineDash([]),w.fillStyle="rgba(94, 234, 212, 0.3)",w.fill()}const E=[...a.players].sort((g,I)=>I.totalAdoptions-g.totalAdoptions);for(const g of a.players){let I=g.id===P?"#7bed9f":oo(g.id);g.shelterColor&&(g.shelterColor.startsWith("gradient:")?I=g.shelterColor.split(":")[1]||I:I=g.shelterColor),w.fillStyle=I;const $=50*h,C=E.indexOf(g),Q=C===0?1.5:C<=2?1.2:1,J=Math.max(2,$)*Q;w.fillRect(g.x*h-J,g.y*h-J,J*2,J*2),C===0&&a.players.length>1&&(w.fillStyle="#ffd700",w.beginPath(),w.arc(g.x*h,g.y*h-J-3,3,0,Math.PI*2),w.fill())}}const k=l.x*h,R=l.y*h,u=l.w*h,v=l.h*h;w.strokeStyle="rgba(255,255,255,0.6)",w.lineWidth=1.5,w.strokeRect(k,R,u,v),w.strokeStyle="rgba(255,255,255,0.2)",w.lineWidth=1,w.strokeRect(.5,.5,119,119);const b=a==null?void 0:a.players.find(S=>S.id===P),B=b!=null&&b.shelterId?((t=a==null?void 0:a.shelters)==null?void 0:t.find(S=>S.id===b.shelterId))??null:null;if(B&&b&&!b.eliminated){const S=(x==null?void 0:x.x)??b.x,E=(x==null?void 0:x.y)??b.y,g=B.x,I=B.y,T=l.x,$=l.x+l.w,C=l.y,Q=l.y+l.h;if(!(g>=T&&g<=$&&I>=C&&I<=Q)){const ve=l.x+l.w/2,Ze=l.y+l.h/2,ee=Math.atan2(I-Ze,g-ve),ke=Math.hypot(g-S,I-E),ze=60,St=L.width/2-ze,_=L.height/2-ze;let W=L.width/2+Math.cos(ee)*St,Qe=L.height/2+Math.sin(ee)*_;const cs=St/_;Math.abs(Math.cos(ee))>Math.abs(Math.sin(ee))*cs?(W=L.width/2+Math.sign(Math.cos(ee))*St,Qe=L.height/2+Math.tan(ee)*Math.sign(Math.cos(ee))*St):(Qe=L.height/2+Math.sign(Math.sin(ee))*_,W=L.width/2+1/Math.tan(ee)*Math.sign(Math.sin(ee))*_),W=Math.max(ze,Math.min(L.width-ze,W)),Qe=Math.max(ze,Math.min(L.height-ze,Qe)),n.save();const ds=.7+.3*Math.sin(Date.now()/300);n.translate(W,Qe),n.rotate(ee),n.fillStyle=`rgba(123, 237, 159, ${ds})`,n.strokeStyle="rgba(255, 255, 255, 0.8)",n.lineWidth=2,n.beginPath(),n.moveTo(20,0),n.lineTo(5,-10),n.lineTo(5,-5),n.lineTo(-15,-5),n.lineTo(-15,5),n.lineTo(5,5),n.lineTo(5,10),n.closePath(),n.fill(),n.stroke(),n.restore(),n.save();const qi=-Math.cos(ee)*35,Xi=-Math.sin(ee)*35,et=W+qi,tt=Qe+Xi;n.fillStyle=`rgba(232, 213, 183, ${ds})`,n.strokeStyle="rgba(123, 237, 159, 0.9)",n.lineWidth=2,n.fillRect(et-12,tt-8,24,18),n.strokeRect(et-12,tt-8,24,18),n.fillStyle=`rgba(123, 237, 159, ${ds})`,n.beginPath(),n.moveTo(et,tt-20),n.lineTo(et-16,tt-8),n.lineTo(et+16,tt-8),n.closePath(),n.fill(),n.stroke(),n.fillStyle="rgba(139, 90, 43, 0.8)",n.fillRect(et-4,tt,8,10),n.fillStyle="#fff",n.font="bold 12px Rubik, sans-serif",n.textAlign="center",n.textBaseline="top";const Gi=ke>=1e3?`${(ke/1e3).toFixed(1)}k`:`${Math.round(ke)}`;n.fillText(Gi,et,tt+14),n.restore()}}if(Ft){const S=L.getBoundingClientRect(),E=L.width/S.width,g=L.height/S.height,I=(Dn-S.left)*E,T=(_n-S.top)*g,$=(es-S.left)*E,C=(ts-S.top)*g,Q=$-I,J=C-T,ve=Math.hypot(Q,J),Ze=Math.min(ve,mo*E),ee=ve>0?I+Q/ve*Ze:I,ke=ve>0?T+J/ve*Ze:T;n.save(),n.globalAlpha=.3,n.strokeStyle="#fff",n.lineWidth=3,n.beginPath(),n.arc(I,T,mo*E,0,Math.PI*2),n.stroke(),n.fillStyle="rgba(255,255,255,0.1)",n.fill(),n.globalAlpha=.6,n.fillStyle="#7bed9f",n.beginPath(),n.arc(ee,ke,20*E,0,Math.PI*2),n.fill(),n.strokeStyle="#fff",n.lineWidth=2,n.stroke(),n.restore()}const m=(a==null?void 0:a.players.find(S=>S.id===P))??x,A=m?Math.floor(m.size):0,D=Math.min(A,Vo),M=(m==null?void 0:m.petsInside.length)??0,H=(a==null?void 0:a.pets.filter(S=>S.insideShelterId===null).length)??0;ma.textContent=m!=null&&m.eliminated?"Observer Mode":`Size: ${A}`,ya.textContent=m!=null&&m.eliminated?"WASD to pan | Drag to move":`Pets: ${M}/${D}`;const j=!!(m!=null&&m.shelterId),N=!!(m!=null&&m.eliminated),U=(m==null?void 0:m.money)??0,Y=m&&m.size>=50&&!j&&!N&&K==="playing";$a.textContent=`${U} RT`;const q=m&&!N&&K==="playing";q?(nn.classList.remove("hidden"),nn.disabled=!1,nn.textContent="Menu [E]"):nn.classList.add("hidden"),Nt&&(q?bt():(Nt=!1,Yn.classList.add("hidden"))),As.classList.add("hidden");const F=(m==null?void 0:m.portCharges)??0;m&&F>0&&!N&&K==="playing"?(Mn.textContent=`Random [P] (${F})`,Mn.classList.remove("hidden")):Mn.classList.add("hidden");const X=(m==null?void 0:m.shelterPortCharges)??0;m&&X>0&&j&&!N&&K==="playing"?(Pn.textContent=`Home [H] (${X})`,Pn.classList.remove("hidden")):Pn.classList.add("hidden");let G=null;if(m&&m.petsInside.length>0&&!N&&K==="playing")for(const S of(a==null?void 0:a.shelters)??[]){if(S.ownerId===P)continue;const E=a==null?void 0:a.players.find(ve=>ve.id===S.ownerId);if(!(((s=m.allies)==null?void 0:s.includes(S.ownerId))||!1))continue;const I=((x==null?void 0:x.x)??m.x)-S.x,T=((x==null?void 0:x.y)??m.y)-S.y,$=Math.hypot(I,T),C=Math.min(S.size,1e3),J=ct+C*dt+100;if($<=J){G=S;break}}G?(it.textContent="Transfer [T] ü§ù",it.classList.remove("hidden"),it.dataset.targetShelterId=G.id):(it.classList.add("hidden"),delete it.dataset.targetShelterId);const z=Math.abs(gt)>50||Math.abs(pt)>50,le=m!=null&&m.shelterId?((o=a==null?void 0:a.shelters)==null?void 0:o.find(S=>S.id===m.shelterId))??null:null;m&&!N&&K==="playing"&&z?zn.classList.remove("hidden"):zn.classList.add("hidden"),m&&!N&&K==="playing"&&le&&Math.hypot(le.x-((x==null?void 0:x.x)??0)-gt,le.y-((x==null?void 0:x.y)??0)-pt)>100?rn.classList.remove("hidden"):rn.classList.add("hidden");const he=(a==null?void 0:a.tick)??0,pe=Jo,vt=m&&(m.speedBoostUntil??0)>he?((m.speedBoostUntil-he)/pe).toFixed(1):"";Eo&&(Eo.textContent=m?`Adoptions: ${m.totalAdoptions}  ‚Ä¢  Strays: ${H}${vt?`  ‚Ä¢  Speed: ${vt}s`:""}`:"");const je=(a==null?void 0:a.matchEndAt)??0,Et=Math.max(0,je-he)/pe,zt=(a==null?void 0:a.shelters)??[],Je=V*ne,be=zt.reduce((S,E)=>!S||E.size>S.size?E:S,null),Wt=Math.min((be==null?void 0:be.size)??0,1e4),wt=be?ct+Wt*dt:0,mn=Math.PI*wt*wt,ro=Je>0?Math.min(100,Math.floor(mn/Je*100)):0,rs=a==null?void 0:a.players.find(S=>S.shelterId===(be==null?void 0:be.id)),yn=(m==null?void 0:m.totalAdoptions)??0;ga.textContent=K==="playing"?`Points: ${yn}`:"";const ls=(a==null?void 0:a.matchDurationMs)??0,Ht=Math.floor(ls/1e3),Ve=Math.floor(Ht/3600),qt=Math.floor(Ht%3600/60),Xt=Ht%60;pa.textContent=`${Ve.toString().padStart(2,"0")}:${qt.toString().padStart(2,"0")}:${Xt.toString().padStart(2,"0")}`;const lo=(a==null?void 0:a.adoptionEvents)??[],co=a;if(ys&&vo)if(lo.length>0&&K==="playing"&&co){const S={[Le]:"Cats",[Hs]:"Dogs",[qs]:"Birds",[Xs]:"Rabbits",[Qn]:"Special"};vo.innerHTML=lo.map(E=>{const g=E.type.replace(/_/g," ").replace(/\b\w/g,C=>C.toUpperCase()),I=Math.max(0,E.startTick+E.durationTicks-co.tick),T=Math.ceil(I/25),$=E.requirements.map(C=>`${C.count} ${S[C.petType]??"Pets"}`).join(", ");return`<div class="event-item"><div class="event-name">${yt(g)}</div><div class="event-reqs">Need: ${yt($)}</div><div class="event-time">${T}s left</div></div>`}).join(""),ys.classList.remove("hidden")}else ys.classList.add("hidden");const Gt=!!(m!=null&&m.eliminated);if((Et<=0||Gt)&&(a!=null&&a.players.length)){p.active&&Zn(!1),Bt||(Bt=!0,ia()),Fe.classList.add("show");const S=Et<=0&&!(a!=null&&a.matchEndedEarly),E=[...a.players].sort((_,W)=>S?W.size-_.size||W.totalAdoptions-_.totalAdoptions:_.eliminated!==W.eliminated?(_.eliminated?1:0)-(W.eliminated?1:0):_.eliminated?_.totalAdoptions-W.totalAdoptions:W.size-_.size||W.totalAdoptions-_.totalAdoptions),g=!!(a!=null&&a.strayLoss),I=E.find(_=>_.id===P),T=I&&!I.eliminated?Math.floor(I.size):0,$=[100,50,25],C=I?E.findIndex(_=>_.id===P)+1:0,Q=C>0&&C<=$.length&&!Gt&&!g?$[C-1]:0,J=g||Gt?0:T+Q,ve=Bt&&!on?Ie()+J:Ie();on||(mt(ve),on=!0);const Ze=C===1?"Win bonus":C===2?"2nd place":C===3?"3rd place":C>0?`${C}th place`:"",ee=J>0?`<br><br><strong>Total: ${ve.toLocaleString()} RT</strong>${Ze?`<br>${Ze}: +${Q} RT`:""}`:g?`<br><br>No RT ‚Äî too many strays! <strong>Total: ${Ie().toLocaleString()} RT</strong>`:Gt?`<br><br><strong>Total: ${Ie().toLocaleString()} RT</strong>`:"";let ke="Match over";if(a!=null&&a.strayLoss)ke="Match lost ‚Äî too many strays!";else if(Gt)ke="You were consumed";else if(a&&a.winnerId){const _=a.winnerId,W=a.players.find(cs=>cs.id===_);ke=`${(W==null?void 0:W.id)===P?"You":(W==null?void 0:W.displayName)??"Someone"} achieved 51% domination!`}const ze=`
      <div class="match-ads">
        <div class="match-ad-slot">
          <h4>Sponsored</h4>
          <div id="match-ad-slot" class="match-ad-placeholder">Ad placeholder</div>
        </div>
        <div class="match-self-promo">
          <h4>Boost your shelter</h4>
          <p>Earn Rescue Tokens each match to buy boosts. Invite friends with your referral link. For every 5 confirmed signups, unlock a special shelter skin.</p>
        </div>
      </div>
    `,St=_=>_.eliminated?"‚Äî":`${Math.floor(_.size)}`;Fe.innerHTML=`<strong>${ke}</strong><br><br>`+E.map((_,W)=>`${W+1}. ${_.id===P?"You":_.displayName??_.id}: size ${St(_)} (${_.totalAdoptions} adoptions)`).join("<br>")+ee+ze+'<button type="button" id="play-again-btn" class="fight-ally-btn ally-btn" style="margin-right:8px">Play again</button><button type="button" id="lobby-btn" class="fight-ally-btn fight-btn">Back to lobby</button>'}else Fe.classList.remove("show")}catch(i){console.error("Render error:",i),n.save(),n.setTransform(1,0,0,1,0,0),n.fillStyle="#3d6b3d",n.fillRect(0,0,L.width,L.height),n.restore()}}let xs=!1;function io(e){xs||(xs=!0,setTimeout(()=>{xs=!1},500),e.id==="play-again-btn"?(d&&(d.close(),d=null),Fe.classList.remove("show"),Bt=!1,Us=!1,a=null,oe.classList.remove("hidden"),oe.innerHTML=ie==="ffa"?"<h2>Connecting‚Ä¶</h2><p>Joining FFA lobby‚Ä¶</p>":"<h2>Connecting‚Ä¶</h2><p>Starting new match.</p>",xe.classList.add("hidden"),no({mode:ie}).then(()=>{oe.classList.add("hidden"),oe.innerHTML="",cn.classList.add("visible"),requestAnimationFrame(so)}).catch(t=>to(t.message||"Connection failed."))):e.id==="lobby-btn"&&(d&&(d.close(),d=null),Fe.classList.remove("show"),Bt=!1,on=!1,a=null,cn.classList.remove("visible"),ns.classList.remove("hidden"),xe.classList.remove("hidden"),Te(),is(),as()))}Fe.addEventListener("click",e=>{const s=e.target.closest("button");s&&(e.preventDefault(),e.stopPropagation(),io(s))},!0);Fe.addEventListener("mouseup",e=>{const s=e.target.closest("button");s&&e.button===0&&(e.preventDefault(),e.stopPropagation(),io(s))},!0);Fe.addEventListener("touchend",e=>{const s=e.target.closest("button");s&&(e.preventDefault(),e.stopPropagation(),io(s))},{passive:!1,capture:!0});Lt.addEventListener("click",()=>{qn||K!=="countdown"||!d||d.readyState!==WebSocket.OPEN||(qn=!0,d.send(JSON.stringify({type:"ready"})),Lt.textContent="Ready!",Rs.textContent="You're ready! Waiting for other player(s)‚Ä¶")});Oa.addEventListener("click",()=>{d&&(d.close(),d=null),xt.classList.add("hidden"),cn.classList.remove("visible"),ns.classList.remove("hidden"),xe.classList.remove("hidden"),Te(),is(),as()});function Oi(e){!at||!d||d.readyState!==WebSocket.OPEN||(d.send(JSON.stringify({type:"fightAlly",targetId:at,choice:e})),$s.add(at),Vt.classList.add("hidden"),at=null)}Ta.addEventListener("click",()=>Oi("fight"));Ba.addEventListener("click",()=>Oi("ally"));As.addEventListener("click",()=>{!d||d.readyState!==WebSocket.OPEN||(d.send(JSON.stringify({type:"ground"})),As.classList.add("hidden"))});Mn.addEventListener("click",()=>{p.active||!d||d.readyState!==WebSocket.OPEN||d.send(JSON.stringify({type:"usePort"}))});Pn.addEventListener("click",()=>{p.active||!d||d.readyState!==WebSocket.OPEN||d.send(JSON.stringify({type:"useShelterPort"}))});it.addEventListener("click",()=>{if(p.active||!d||d.readyState!==WebSocket.OPEN)return;const e=it.dataset.targetShelterId;e&&d.send(JSON.stringify({type:"transferPets",targetShelterId:e}))});zn.addEventListener("click",()=>{gt=0,pt=0,zn.classList.add("hidden")});rn.addEventListener("click",()=>{var s;const e=a==null?void 0:a.players.find(o=>o.id===P),t=e!=null&&e.shelterId?(s=a==null?void 0:a.shelters)==null?void 0:s.find(o=>o.id===e.shelterId):null;t&&x&&(gt=t.x-x.x,pt=t.y-x.y),rn.classList.add("hidden")});nn.addEventListener("click",()=>{Di()});let Nt=!1;function Di(){if(K!=="playing")return;const e=a==null?void 0:a.players.find(t=>t.id===P);!e||e.eliminated||(Nt=!Nt,Nt?(Yn.classList.remove("hidden"),bt()):Yn.classList.add("hidden"))}function Pr(){var s;if(!a)return null;const e=a.players.find(o=>o.id===P);return e!=null&&e.shelterId?((s=a.shelters)==null?void 0:s.find(o=>o.id===e.shelterId))??null:null}function bt(){const e=a==null?void 0:a.players.find(u=>u.id===P);if(!e)return;const t=Math.floor(e.size),s=e.money??0,o=!!e.shelterId,i=Pr(),r=!!e.vanSpeedUpgrade;o?(wo.classList.add("hidden"),vn.classList.remove("hidden"),En.classList.remove("hidden"),wn.classList.remove("hidden")):(wo.classList.remove("hidden"),vn.classList.add("hidden"),En.classList.add("hidden"),wn.classList.add("hidden"));const c=Math.min(100,t/50*100),l=Math.min(100,s/250*100);Pa.textContent=`${t}/50`,Aa.style.width=`${c}%`,Ra.textContent=`${s}/250 RT`,Na.style.width=`${l}%`;const f=t>=50&&s>=250&&!o;if(qe.disabled=!f,f)qe.textContent="Build Shelter",qe.classList.add("ready");else if(o)qe.textContent="Already Built",qe.classList.remove("ready");else{const u=[];t<50&&u.push(`Size ${t}/50`),s<250&&u.push(`${s}/250 RT`),qe.textContent=`Need: ${u.join(" & ")}`,qe.classList.remove("ready")}const y=o&&!(i!=null&&i.hasAdoptionCenter)&&s>=250,h=o&&!(i!=null&&i.hasGravity)&&s>=300,k=o&&!(i!=null&&i.hasAdvertising)&&s>=200,R=!r&&s>=150;Zt.disabled=!y,Zt.textContent=i!=null&&i.hasAdoptionCenter?"Owned":"Buy",y?Zt.classList.add("ready"):Zt.classList.remove("ready"),i!=null&&i.hasAdoptionCenter?vn.classList.add("owned"):vn.classList.remove("owned"),Qt.disabled=!h,Qt.textContent=i!=null&&i.hasGravity?"Owned":"Buy",h?Qt.classList.add("ready"):Qt.classList.remove("ready"),i!=null&&i.hasGravity?En.classList.add("owned"):En.classList.remove("owned"),en.disabled=!k,en.textContent=i!=null&&i.hasAdvertising?"Owned":"Buy",k?en.classList.add("ready"):en.classList.remove("ready"),i!=null&&i.hasAdvertising?wn.classList.add("owned"):wn.classList.remove("owned"),tn.disabled=!R,tn.textContent=r?"Owned":"Buy",R?tn.classList.add("ready"):tn.classList.remove("ready"),r?So.classList.add("owned"):So.classList.remove("owned")}document.addEventListener("keydown",e=>{if((e.key==="e"||e.key==="E")&&Di(),e.key==="p"||e.key==="P"){if(p.active)return;if(d&&d.readyState===WebSocket.OPEN){const t=a==null?void 0:a.players.find(s=>s.id===P);t&&(t.portCharges??0)>0&&!t.eliminated&&K==="playing"&&d.send(JSON.stringify({type:"usePort"}))}}if(e.key==="h"||e.key==="H"){if(p.active)return;if(d&&d.readyState===WebSocket.OPEN){const t=a==null?void 0:a.players.find(s=>s.id===P);t&&(t.shelterPortCharges??0)>0&&t.shelterId&&!t.eliminated&&K==="playing"&&d.send(JSON.stringify({type:"useShelterPort"}))}}});Ma.addEventListener("click",()=>{Nt=!1,Yn.classList.add("hidden")});qe.addEventListener("click",()=>{if(!d||d.readyState!==WebSocket.OPEN)return;const e=a==null?void 0:a.players.find(t=>t.id===P);!e||e.eliminated||e.shelterId||e.size<50||(e.money??0)<250||(d.send(JSON.stringify({type:"buildShelter"})),bt())});Zt.addEventListener("click",()=>{!d||d.readyState!==WebSocket.OPEN||(d.send(JSON.stringify({type:"buyAdoptionCenter"})),bt())});Qt.addEventListener("click",()=>{!d||d.readyState!==WebSocket.OPEN||(d.send(JSON.stringify({type:"buyGravity"})),bt())});en.addEventListener("click",()=>{!d||d.readyState!==WebSocket.OPEN||(d.send(JSON.stringify({type:"buyAdvertising"})),bt())});tn.addEventListener("click",()=>{!d||d.readyState!==WebSocket.OPEN||(d.send(JSON.stringify({type:"buyVanSpeed"})),bt())});Mt.checked=Dt();Ms.checked=li();Mt.addEventListener("change",()=>{ri(Mt.checked),Mt.checked&&un()});Ms.addEventListener("change",()=>ea(Ms.checked));va.addEventListener("click",()=>Gs.classList.toggle("hidden"));wa.addEventListener("click",()=>Gs.classList.add("hidden"));Ea.addEventListener("click",async()=>{(d==null?void 0:d.readyState)===WebSocket.OPEN&&(ie==="solo"?se("Your match has been saved.","success"):(ie==="ffa"||ie==="teams")&&se("Your van will stop but your shelter continues.","info"),Gs.classList.add("hidden"),d.close(),d=null,P=null,a=null,Fe.classList.remove("show"),Bt=!1,on=!1,or(),cn.classList.remove("visible"),ns.classList.remove("hidden"),xe.classList.remove("hidden"),Te(),is(),ie==="solo"&&(Xe=!0,Ut()),Qs(),as())});Ia.addEventListener("click",()=>{d&&(d.close(),d=null),oe.classList.remove("hidden"),oe.innerHTML="<h2>Switching server‚Ä¶</h2><p>Reconnecting to a closer server.</p>",xe.classList.add("hidden"),no({latency:Ts,mode:ie}).then(()=>{oe.classList.add("hidden"),oe.innerHTML=""}).catch(e=>{to(e.message||"Switch failed."),xe.classList.remove("hidden")})});function is(){document.querySelectorAll(".mode-option").forEach(e=>{e.dataset.mode===ie?e.classList.add("selected"):e.classList.remove("selected")})}const Ln=localStorage.getItem(bi);(Ln==="ffa"||Ln==="teams"||Ln==="solo")&&(ie=Ln);is();const ks=document.getElementById("solo-options"),Xo=document.getElementById("cpu-shutdown-breeders");function _i(){ks&&(ie==="solo"?ks.classList.remove("hidden"):ks.classList.add("hidden"))}document.querySelectorAll(".mode-option").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".mode-option").forEach(t=>t.classList.remove("selected")),e.classList.add("selected"),ie=e.dataset.mode,localStorage.setItem(bi,ie),_i(),Ut()})});_i();Ps.addEventListener("click",async()=>{if(!ge||!ge.referralCode)return;const e=Ci(ge.referralCode);try{await navigator.clipboard.writeText(e),ft.textContent="Referral link copied."}catch{const t=document.createElement("input");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),ft.textContent="Referral link copied."}});Bn.addEventListener("click",async()=>{try{const t=await(await fetch("/referrals/claim",{method:"POST",credentials:"include"})).json();if(t.ok){const s=typeof t.moneyBonus=="number"?t.moneyBonus:0;s>0&&mt(Ie()+s),localStorage.setItem(Za,"1"),ft.textContent="Reward claimed. Special skin unlocked.",await Ti(),Bi(),Te()}else ft.textContent="Reward not available yet."}catch{ft.textContent="Unable to claim reward. Try again."}});function zs(e){un(),Zr(),ns.classList.add("hidden"),oe.classList.remove("hidden"),oe.innerHTML=e.resume?"<h2>Resuming‚Ä¶</h2><p>Loading your saved match.</p>":"<h2>Connecting‚Ä¶</h2><p>Waiting for game server.</p>",xe.classList.add("hidden"),no({mode:e.mode,abandon:e.abandon}).then(()=>{oe.classList.add("hidden"),cn.classList.add("visible"),Mt&&(Mt.checked=Dt()),requestAnimationFrame(so)}).catch(t=>{to(t.message||"Connection failed."),xe.classList.remove("hidden")})}const Go=document.getElementById("resume-match-btn");Go&&Go.addEventListener("click",()=>{ie==="solo"&&zs({mode:"solo",resume:!0})});xa.addEventListener("click",()=>{if(ie==="solo"&&Xe){ar(()=>{fetch("/api/saved-match",{method:"DELETE",credentials:"include"}).then(()=>{Xe=!1,Ut(),zs({mode:"solo",abandon:!0})}).catch(()=>se("Failed to abandon saved match.","error"))});return}zs({mode:ie})});localStorage.getItem(js)||Ks.classList.remove("hidden");ka.addEventListener("click",()=>{localStorage.setItem(js,"full"),Ks.classList.add("hidden")});La.addEventListener("click",()=>{localStorage.setItem(js,"essential"),Ks.classList.add("hidden")});Te();document.querySelectorAll(".landing-buy").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.boost;if(!t||!(t in Xn))return;const s=Xn[t],o=Ie();o<s||(mt(o-s),t==="size"?ue.sizeBonus+=1:t==="speed"?ue.speedBoost=!0:t==="adoptSpeed"&&(ue.adoptSpeed=!0),Te())})});ut();document.querySelectorAll(".color-btn").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.color;t&&(_t(t),ut())})});document.querySelectorAll(".preset-color").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.color;t&&ss().preset&&(_t(t),ut())})});const Se=document.getElementById("color-picker-modal"),It=document.getElementById("color-picker-input"),rt=document.getElementById("color-picker-input2"),Cn=document.getElementById("color-picker-title"),Ls=document.getElementById("color-picker-cancel"),Cs=document.getElementById("color-picker-confirm");let Ws="custom";document.querySelectorAll(".color-buy").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.color,s=Gn[t],o=ss(),i=Ie();if(t==="preset"){if(o.preset||i<s)return;mt(i-s),Ds({...o,preset:!0}),Te(),ut()}else if(t==="custom"){if(o.custom){_t(o.custom),ut();return}if(i<s)return;Ws="custom",Cn&&(Cn.textContent="Pick Your Custom Color"),rt&&(rt.style.display="none"),Se==null||Se.classList.remove("hidden")}else if(t==="gradient"){if(o.gradient){_t(o.gradient),ut();return}if(i<s)return;Ws="gradient",Cn&&(Cn.textContent="Pick Gradient Colors"),rt&&(rt.style.display="block"),Se==null||Se.classList.remove("hidden")}})});Ls==null||Ls.addEventListener("click",()=>{Se==null||Se.classList.add("hidden")});Cs==null||Cs.addEventListener("click",()=>{const e=ss(),t=Ie();if(Ws==="custom"){const s=(It==null?void 0:It.value)||"#ff5500";mt(t-Gn.custom),Ds({...e,custom:s}),_t(s)}else{const s=(It==null?void 0:It.value)||"#ff5500",o=(rt==null?void 0:rt.value)||"#00aaff",i=`gradient:${s}:${o}`;mt(t-Gn.gradient),Ds({...e,gradient:i}),_t(i)}Se==null||Se.classList.add("hidden"),Te(),ut()});Kt&&(Kt.checked=Dt(),Kt.addEventListener("change",()=>{ri(Kt.checked),Kt.checked&&un()}));Dt()&&un();function Ar(e){return e<=5?15:e<=9?30:e<=14?40:45}function Rr(e,t=1,s={}){p.active=!0,p.pets=[],p.selectedPetIndex=null,p.timeLeft=typeof s.timeLimitSeconds=="number"?s.timeLimitSeconds:Ar(t),p.totalPets=e,p.rescuedCount=0,p.level=t,p.selectedIngredients=[],p.isMill=!!s.isMill;const o=["dog","cat","horse","bird","rabbit"];for(let f=0;f<e;f++){const y=o[Math.floor(Math.random()*o.length)];p.pets.push({type:y,rescued:!1})}Nr(t),fn(),$t(),lt(),hi.classList.add("hidden"),Ge.style.display="flex",Ns.classList.add("show");const i=Ns.querySelector(".breeder-title");i&&(i.textContent=p.isMill?"üõë Stop the Mill!":`üö® Stop Level ${t} Breeders!`);const r=document.getElementById("breeder-instruction-1"),c=document.getElementById("breeder-instruction-2"),l=hn(t);r&&c&&(l===1?(r.textContent="1. Click a pet to select it",c.textContent="2. Click the matching food to rescue it!"):(r.textContent=`1. Click ${l} ingredients to make a meal`,c.textContent="2. Select a pet - if the meal matches, they're rescued!")),p.timerInterval=setInterval(()=>{p.timeLeft--,Da.textContent=`${p.timeLeft}s`,p.timeLeft<=0&&Zn(!1)},1e3)}function Nr(e){const t=Ge.querySelector('[data-food="water"]'),s=Ge.querySelector('[data-food="bowl"]');t&&(t.style.display=e>=6?"flex":"none"),s&&(s.style.display=e>=10?"flex":"none")}function lt(){var r;const e=hn(p.level);let t=document.getElementById("breeder-selected-ingredients");if(t||(t=document.createElement("div"),t.id="breeder-selected-ingredients",t.className="breeder-ingredients",(r=Ge.parentNode)==null||r.insertBefore(t,Ge)),e<=1){t.style.display="none";return}t.style.display="flex";const s={apple:"üçé",carrot:"ü•ï",chicken:"üçó",seeds:"üåª",water:"üíß",bowl:"ü•£"},o=[];for(let c=0;c<e;c++)if(c<p.selectedIngredients.length){const l=p.selectedIngredients[c];o.push(`<div class="ingredient-slot filled">${s[l]}</div>`)}else o.push('<div class="ingredient-slot empty">?</div>');t.innerHTML=`
    <span class="ingredients-label">Building meal (${p.selectedIngredients.length}/${e}):</span>
    <div class="ingredient-slots">${o.join("")}</div>
    ${p.selectedIngredients.length>0?'<button type="button" class="clear-ingredients-btn" id="clear-ingredients">Clear</button>':""}
  `;const i=document.getElementById("clear-ingredients");i&&i.addEventListener("click",()=>{p.selectedIngredients=[],lt(),$t()})}function fn(){Io.innerHTML=p.pets.map((e,t)=>`
    <div class="breeder-pet${e.rescued?" rescued":""}${p.selectedPetIndex===t?" selected":""}" 
         data-index="${t}">
      <span>${Va[e.type]}</span>
      <span class="breeder-pet-label">${e.type}</span>
    </div>
  `).join(""),Io.querySelectorAll(".breeder-pet:not(.rescued)").forEach(e=>{e.addEventListener("click",()=>{const t=parseInt(e.dataset.index??"-1",10);t>=0&&!p.pets[t].rescued&&(p.selectedPetIndex=t,fn(),$t())})})}function $t(){const e=a==null?void 0:a.players.find(o=>o.id===P),t=(e==null?void 0:e.money)??0;_a.textContent=`Your Tokens: ${t} RT`;const s=hn(p.level);Ge.querySelectorAll(".breeder-food-btn").forEach(o=>{const i=o.dataset.food,r=pi[i],c=t>=r,l=p.selectedIngredients.includes(i);s===1?o.disabled=!c||p.selectedPetIndex===null:o.disabled=!c||l})}function $r(e,t){const s=hn(p.level),o=Ja[s];if(!o)return!1;const i=[...e].sort();for(const r of o){if(!r.worksOn.includes(t))continue;const c=[...r.ingredients].sort();if(i.length!==c.length)continue;let l=!0;for(let f=0;f<i.length;f++)if(i[f]!==c[f]){l=!1;break}if(l)return!0}return!1}function Or(e){const t=pi[e],s=a==null?void 0:a.players.find(r=>r.id===P);if(((s==null?void 0:s.money)??0)<t)return;const i=hn(p.level);if(i===1){if(p.selectedPetIndex===null)return;const r=p.pets[p.selectedPetIndex];if(!r||r.rescued)return;if((d==null?void 0:d.readyState)===WebSocket.OPEN){const l=ja[e].includes(r.type);d.send(JSON.stringify({type:"breederUseFood",food:e,petIndex:p.selectedPetIndex,petType:r.type,success:l})),l?(r.rescued=!0,p.rescuedCount++,p.selectedPetIndex=null,$n(),p.rescuedCount>=p.totalPets?Zn(!0):fn()):On(),$t()}return}if(p.selectedIngredients.includes(e)){se("Already added to meal!");return}if((d==null?void 0:d.readyState)===WebSocket.OPEN&&d.send(JSON.stringify({type:"breederUseFood",food:e,petIndex:-1,petType:"ingredient",success:!1})),p.selectedIngredients.push(e),lt(),$t(),p.selectedIngredients.length>=i){if(p.selectedPetIndex===null){se("Select a pet to feed this meal to!");return}const r=p.pets[p.selectedPetIndex];if(!r||r.rescued){p.selectedIngredients=[],lt();return}$r(p.selectedIngredients,r.type)?(r.rescued=!0,p.rescuedCount++,p.selectedPetIndex=null,p.selectedIngredients=[],$n(),se("Meal complete! Pet rescued!","success"),p.rescuedCount>=p.totalPets?Zn(!0):(fn(),lt())):(p.selectedIngredients=[],On(),se("Wrong meal! Try again.","error"),lt()),$t()}}function Zn(e){p.timerInterval&&(clearInterval(p.timerInterval),p.timerInterval=null),(d==null?void 0:d.readyState)===WebSocket.OPEN&&d.send(JSON.stringify({type:"breederComplete",rescuedCount:p.rescuedCount,totalPets:p.totalPets,level:p.level})),Ge.style.display="none",hi.classList.remove("hidden"),Ua.textContent=e?"All Pets Rescued!":`Time's Up! (${p.rescuedCount}/${p.totalPets})`,mi.innerHTML='<p style="color:rgba(255,255,255,0.7)">Calculating rewards...</p>'}function Dr(e,t){const s=t.some(f=>f.type==="penalty"),o=e>0||t.some(f=>f.type!=="penalty"),i=[],r=t.find(f=>f.type==="penalty");r&&i.push(`<div class="breeder-reward-item" style="color:#ff6b6b;">-${r.amount} Size (pets escaped!)</div>`),e>0&&i.push(`<div class="breeder-reward-item">+${e} RT</div>`),t.forEach(f=>{f.type==="size"&&i.push(`<div class="breeder-reward-item">+${f.amount} Size</div>`),f.type==="speed"&&i.push('<div class="breeder-reward-item">Speed Boost!</div>'),f.type==="port"&&i.push(`<div class="breeder-reward-item">+${f.amount} Port Charge</div>`)});const c=o?"üéÅ Rescue Chest":s?"‚ùå Breeder Escape!":"No Rewards",l=o?"#ffd93d":"#ff6b6b";mi.innerHTML=`
    <div class="breeder-result-title" style="color:${l};margin-bottom:8px;">${c}</div>
    ${i.join("")}
  `}function _r(){p.active=!1,Ns.classList.remove("show")}Ge.querySelectorAll(".breeder-food-btn").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.food;t&&Or(t)})});Fa.addEventListener("click",_r);let de=null;function Ui(e){const t=[];return e.tokens>0&&t.push(`${e.tokens} RT`),e.sizeBonus&&t.push(`+${e.sizeBonus} Size`),e.speedBoost&&t.push("Speed"),e.portCharge&&t.push("Random Port"),t.join(" + ")}function Fi(){if(!de)return;const{currentDay:e,canClaimToday:t,rewards:s}=de;let o="";const i=!fe;for(let r=0;r<7;r++){const c=r+1,l=s[r];let f=!1,y=!1,h=!0;i||(f=c===e&&t,y=c<e,h=c>e||c===e&&!t);const k=["daily-gift-day",f?"current":"",y?"claimed":"",h||i?"locked":"",c===7?"daily-gift-day7":""].filter(Boolean).join(" ");o+=`
      <div class="${k}">
        <div class="daily-gift-day-label">Day ${c}</div>
        <div class="daily-gift-day-icon">${y?"‚úì":f?"üîì":"üîí"}</div>
        <div class="daily-gift-day-reward">${Ui(l)}</div>
      </div>
    `}fe?(xo.innerHTML=o,nt.classList.remove("hidden"),t?(nt.disabled=!1,nt.textContent=`Claim Day ${e} Gift`,ws.textContent="Play to unlock today's gift!"):(nt.disabled=!0,nt.textContent="Come back tomorrow!",ws.textContent=`Next gift: Day ${e>7?1:e}`)):(o=`
      <div class="daily-gift-signin-overlay">
        <div class="daily-gift-signin-message">Sign in for daily gifts!</div>
        <div class="daily-gift-signin-buttons">
          <a href="${kt("/auth/google")}" class="daily-gift-signin-btn google">Sign in with Google</a>
        </div>
      </div>
      <div class="daily-gift-grid-greyed">${o}</div>
    `,xo.innerHTML=o,nt.classList.add("hidden"),ws.textContent="")}async function Yi(){if(st.classList.remove("hidden"),!fe){de={currentDay:1,canClaimToday:!0,lastClaimDate:null,totalClaims:0,rewards:[{tokens:15},{tokens:25,speedBoost:!0},{tokens:40},{tokens:50,sizeBonus:3},{tokens:75,speedBoost:!0},{tokens:100,portCharge:!0},{tokens:150,sizeBonus:5,speedBoost:!0}]},st.classList.add("has-gift");return}try{const e=await fetch("/api/daily-gift",{credentials:"include"});if(!e.ok){de={currentDay:1,canClaimToday:!0,lastClaimDate:null,totalClaims:0,rewards:[{tokens:15},{tokens:25,speedBoost:!0},{tokens:40},{tokens:50,sizeBonus:3},{tokens:75,speedBoost:!0},{tokens:100,portCharge:!0},{tokens:150,sizeBonus:5,speedBoost:!0}]},st.classList.add("has-gift");return}de=await e.json(),de!=null&&de.canClaimToday?st.classList.add("has-gift"):st.classList.remove("has-gift")}catch{de={currentDay:1,canClaimToday:!0,lastClaimDate:null,totalClaims:0,rewards:[{tokens:15},{tokens:25,speedBoost:!0},{tokens:40},{tokens:50,sizeBonus:3},{tokens:75,speedBoost:!0},{tokens:100,portCharge:!0},{tokens:150,sizeBonus:5,speedBoost:!0}]},st.classList.add("has-gift")}Vr()}function zi(){de&&(Fi(),yi.classList.add("show"))}function Wi(){yi.classList.remove("show")}async function Ur(){var e;if(!fe){se("Sign in to collect daily rewards!"),Wi();return}if(de!=null&&de.canClaimToday)try{const t=await fetch("/api/daily-gift/claim",{method:"POST",credentials:"include"});if(!t.ok){const i=await t.json();se(i.error||"Failed to claim gift");return}const s=await t.json();(e=s.reward)!=null&&e.tokens&&(mt(Ie()+s.reward.tokens),Te()),await Yi(),Fi();const o=Ui(s.reward);se(`Gift claimed: ${o}`,"success")}catch{se("Failed to claim gift")}}st.addEventListener("click",zi);Ya.addEventListener("click",Wi);nt.addEventListener("click",Ur);sn.addEventListener("click",zi);let ot="alltime",Nn="score";const Ot=document.getElementById("leaderboard-sort");async function Fr(e){try{const t=e?`?limit=${e}`:"",s=await fetch(`/api/match-history${t}`,{credentials:"include"});return s.ok?(await s.json()).matches??[]:[]}catch{return[]}}async function Yr(e,t){try{const s=(e==="alltime"||e==="games")&&t?`&sort=${t}`:"",o=await fetch(`/api/leaderboard?type=${e}${s}`,{credentials:"include"});return o.ok?(await o.json()).entries??[]:[]}catch{return[]}}async function zr(){try{const e=await fetch("/api/leaderboard/my-rank",{credentials:"include"});return e.ok?await e.json():{alltime:{rank:0},daily:{rank:0}}}catch{return{alltime:{rank:0},daily:{rank:0}}}}function Wr(e){const t=new Date(e),o=Date.now()-e;return o<6e4?"Just now":o<36e5?`${Math.floor(o/6e4)}m ago`:o<864e5?`${Math.floor(o/36e5)}h ago`:t.toLocaleDateString(void 0,{month:"short",day:"numeric",year:t.getFullYear()!==new Date().getFullYear()?"numeric":void 0})}function Hr(e){if(e<60)return`${e}s`;const t=Math.floor(e/60),s=e%60;return s?`${t}m ${s}s`:`${t}m`}function qr(e){if(e.length===0){Wn.innerHTML='<div class="leaderboard-empty">No match history yet. Play matches to see them here!</div>',Ct.innerHTML=fe?"Your recent matches":"Sign in to see your match history";return}const t={win:"Win",loss:"Loss",stray_loss:"Stray loss",quit:"Quit"};Wn.innerHTML=e.map(s=>{const o=t[s.result]??s.result;return`
      <div class="match-history-entry">
        <span class="match-history-result ${s.result==="win"?"history-win":s.result==="stray_loss"?"history-stray":s.result==="quit"?"history-quit":"history-loss"}">${o}</span>
        <span class="match-history-mode">${yt(s.mode)}</span>
        <span class="match-history-rt">${s.rt_earned} RT</span>
        <span class="match-history-adopt">${s.adoptions} adoptions</span>
        <span class="match-history-dur">${Hr(s.duration_seconds)}</span>
        <span class="match-history-date">${Wr(s.played_at)}</span>
      </div>
    `}).join(""),Ct.innerHTML=`Your last ${e.length} matches`}function Xr(e,t){if(e.length===0){Wn.innerHTML='<div class="leaderboard-empty">No rankings yet. Play to be the first!</div>',Ct.innerHTML="";return}Wn.innerHTML=e.map(s=>{const o=s.rank===1?"gold":s.rank===2?"silver":s.rank===3?"bronze":"",i=s.displayName===we?"highlight":"",r=s.shelterColor?`<span class="leaderboard-color" style="background:${s.shelterColor}"></span>`:"";return`
      <div class="leaderboard-entry ${i}">
        <div class="leaderboard-rank ${o}">#${s.rank}</div>
        ${r}
        <div class="leaderboard-name">${yt(s.displayName)}</div>
        <div class="leaderboard-stats">
          <span class="wins">${s.wins} wins</span>${typeof s.gamesPlayed=="number"?` ¬∑ ${s.gamesPlayed} games`:""}${typeof s.losses=="number"?` ¬∑ ${s.losses} losses`:""}<br>
          ${s.rtEarned} RT
        </div>
      </div>
    `}).join(""),t>0&&t<=10?Ct.innerHTML=`Your rank: <strong>#${t}</strong> (Top 10 gets daily rewards!)`:t>10?Ct.innerHTML=`Your rank: <strong>#${t}</strong> - Get into top 10 for daily rewards!`:Ct.innerHTML="Win matches to appear on the leaderboard!"}async function Gr(){gi.classList.add("show"),await ao()}function Kr(){gi.classList.remove("show")}async function ao(){const e=Ot==null?void 0:Ot.closest(".leaderboard-sort");if(ot==="history"){e==null||e.classList.add("hidden");const i=await Fr(50);qr(i);return}e==null||e.classList.remove("hidden");const s=await Yr(ot,ot==="games"&&Nn==="score"?"games":Nn);let o;if(ot==="alltime"||ot==="daily"){const i=await zr();o=ot==="alltime"?i.alltime.rank:i.daily.rank}else{const i=s.find(r=>r.displayName===we);o=i?i.rank:0}Xr(s,o)}document.querySelectorAll(".leaderboard-tab").forEach(e=>{e.addEventListener("click",async()=>{document.querySelectorAll(".leaderboard-tab").forEach(t=>t.classList.remove("active")),e.classList.add("active"),ot=e.dataset.type,await ao()})});Ot&&Ot.addEventListener("change",async()=>{Nn=Ot.value,await ao()});Ha.addEventListener("click",Gr);Wa.addEventListener("click",Kr);async function jr(){try{const e=await fetch("/api/inventory",{credentials:"include"});if(!e.ok)return;Pe=await e.json(),Hi()}catch{}}function Hi(){qa.textContent=String(Pe.storedRt),Xa.textContent=String(Pe.portCharges),Ga.textContent=String(Pe.speedBoosts),Ka.textContent=String(Pe.sizeBoosts),Pe.signedIn?(Pe.storedRt>0||Pe.portCharges>0?jt.textContent="Items will be used next match":jt.textContent="Earn items by winning matches!",jt.classList.add("signed-in")):(jt.textContent="Sign in to save equipment",jt.classList.remove("signed-in"))}async function Jr(){if(!fe)return{rt:0,ports:0};try{const e=await fetch("/api/inventory/withdraw",{method:"POST",credentials:"include"});if(!e.ok)return{rt:0,ports:0};const t=await e.json();return Pe={storedRt:0,portCharges:0,speedBoosts:0,sizeBoosts:0,signedIn:!0},Hi(),{rt:t.storedRt??0,ports:t.portCharges??0}}catch{return{rt:0,ports:0}}}function Vr(){de?(sn.classList.remove("hidden"),de.canClaimToday||!fe?sn.classList.add("has-gift"):sn.classList.remove("has-gift")):sn.classList.add("hidden")}async function Ko(){try{const e=await fetch("/api/server-time",{credentials:"include"});if(!e.ok)return;const t=await e.json();typeof t.nextMidnightUtc=="string"&&(Bs=t.nextMidnightUtc)}catch{}}function jo(){const e=new Date,t=e.getUTCHours(),s=e.getUTCMinutes(),o=e.getUTCSeconds();if(za.textContent=`${String(t).padStart(2,"0")}:${String(s).padStart(2,"0")}:${String(o).padStart(2,"0")} UTC`,Bs){const i=new Date(Bs).getTime();let r=Math.max(0,i-Date.now());const c=Math.floor(r/36e5);r%=36e5;const l=Math.floor(r/6e4);ko.textContent=`Next daily gift: in ${c}h ${l}m`}else ko.textContent="Next daily gift: at 00:00 UTC"}function as(){an||(Ko(),jo(),an=setInterval(()=>{jo()},1e3),setInterval(()=>Ko(),3e4))}function Zr(){an&&(clearInterval(an),an=null)}lr();dr().then(()=>jr());Te();as();window.addEventListener("resize",Pi);Pi();
